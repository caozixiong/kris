<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>儿童互动数学游戏</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">
    <style>
        /* --- 全局及布局样式 --- */
        :root {
            --blue-light: #e9f5ff;
            --blue-mid: #74c0fc;
            --blue-dark: #4dabf7;
            --red-light: #ff8787;
            --red-main: #ff6b6b;
            --green-main: #40c057;
            --yellow-main: #fcc419;
            --dark-text: #333;
            --light-bg: #f0f8ff;
        }

        body {
            font-family: 'Comic Sans MS', 'Chalkboard SE', 'Marker Felt', '楷体', sans-serif;
            background-color: var(--light-bg);
            margin: 0;
            padding: 10px;
            text-align: center;
            color: var(--dark-text);
            user-select: none;
            -webkit-user-select: none;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
        }

        .main-container {
            max-width: 900px;
            margin: 0 auto;
        }
        
        #game-selector-area {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 8px;
            margin-bottom: 20px;
        }

        #game-selector-area button {
            padding: 10px 15px;
            font-size: 16px;
            font-weight: bold;
            background-color: #0097a7; /* Cyan */
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.2s, box-shadow 0.2s, transform 0.2s;
            min-width: 50px;
        }

        #game-selector-area button:hover {
            background-color: #00acc1;
            transform: translateY(-2px);
        }
        
        #game-selector-area button.active {
            background-color: #ff8f00; /* Amber */
            box-shadow: 0 0 0 3px #fff, 0 0 0 6px #ffc107;
            transform: scale(1.05);
        }
        
        .game-host-container {
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 10px 0;
        }

        /* --- 游戏 1 (数图形) 样式 --- */
        #game1-host .game-container {
            width: 100%;
            max-width: 800px;
            background-color: white;
            border-radius: 20px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
            padding: 15px;
            position: relative;
        }
        #game1-host h1 { color: var(--red-main); margin-bottom: 15px; font-size: 24px; }
        #game1-host .cheer { color: var(--red-main); font-size: 22px; font-weight: bold; margin-bottom: 15px; animation: game1-pulse 2s infinite; }
        @keyframes game1-pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.05); } }
        #game1-host .timer { position: absolute; top: 15px; right: 15px; background-color: var(--red-light); color: white; border-radius: 50%; width: 50px; height: 50px; display: flex; align-items: center; justify-content: center; font-size: 24px; font-weight: bold; }
        #game1-host .shapes-container { height: 200px; margin: 20px auto; background-color: #f8f9fa; border-radius: 15px; display: flex; flex-wrap: wrap; align-items: center; justify-content: center; padding: 15px; position: relative; }
        #game1-host .shape { margin: 8px; transition: transform 0.2s; }
        #game1-host .shape svg { width: 40px; height: 40px; }
        #game1-host .numbers { display: flex; flex-wrap: wrap; justify-content: center; gap: 10px; margin: 15px 0; }
        #game1-host .number { background-color: var(--blue-mid); color: white; border: none; border-radius: 50%; width: 55px; height: 55px; font-size: 22px; cursor: pointer; transition: transform 0.2s, background-color 0.2s; display: flex; align-items: center; justify-content: center; }
        #game1-host .number:hover, #game1-host .number:active { transform: scale(1.1); background-color: var(--blue-dark); }
        #game1-host .message { height: 40px; font-size: 24px; margin: 15px 0; font-weight: bold; }
        #game1-host .message.correct { color: var(--green-main); }
        #game1-host .message.wrong { color: #fa5252; }
        #game1-host .score { font-size: 20px; margin-top: 15px; color: #495057; }
        #game1-host .stars { margin: 15px 0; font-size: 26px; color: var(--yellow-main); }
        #game1-host .celebration { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 100; display: none; }
        #game1-host .confetti { position: absolute; width: 10px; height: 10px; background-color: #f76707; border-radius: 50%; }
        #game1-host .progress-bar { height: 15px; background-color: #e9ecef; border-radius: 8px; margin: 10px 0; overflow: hidden; }
        #game1-host .progress { height: 100%; background-color: var(--red-main); width: 0%; transition: width 0.5s; }
        @media (max-width: 600px) {
            #game1-host .game-container { padding: 10px; }
            #game1-host h1 { font-size: 20px; margin-bottom: 10px; }
            #game1-host .cheer { font-size: 18px; }
            #game1-host .timer { width: 40px; height: 40px; font-size: 20px; top: 10px; right: 10px; }
            #game1-host .shapes-container { height: 180px; margin: 15px auto; }
            #game1-host .shape svg { width: 35px; height: 35px; }
            #game1-host .number { width: 45px; height: 45px; font-size: 20px; }
            #game1-host .message { font-size: 20px; height: 30px; }
        }

        /* --- 游戏 2, 3, 4 (共享及特定) 样式 --- */
        .game234-host .more-challenging-btn { margin-bottom: 10px; padding: 10px 15px; font-size: 16px; background-color: #ffc107; color: black; border: none; border-radius: 8px; cursor: pointer; box-shadow: 0 2px 4px rgba(0,0,0,0.2); transition: background-color 0.2s; }
        .game234-host .more-challenging-btn:hover, .game234-host .more-challenging-btn:active { background-color: #e0a800; }
        .game234-host .game-container { width: 100%; max-width: 500px; display: flex; flex-direction: column; align-items: center; background-color: white; border-radius: 20px; padding: 15px; box-shadow: 0 0 15px rgba(0, 0, 0, 0.2); position: relative; }
        .game234-host .shapes-container { display: flex; justify-content: space-around; width: 100%; margin-bottom: 20px; min-height: 120px; }
        .game234-host .shape-group { display: flex; flex-wrap: wrap; justify-content: center; align-items: center; width: 45%; padding: 10px; border: 2px dashed #70a1ff; border-radius: 10px; }
        #game3-host .shape-group { width: 90%; max-width: 100%; justify-content: center; }
        #game3-host .shapes-container { justify-content: center; }
        .game234-host .shape { margin: 5px; font-size: 30px; }
        .game234-host .math-container { width: 100%; display: flex; flex-direction: column; align-items: center; }
        .game234-host .math-row { display: flex; align-items: center; width: 100%; margin: 5px 0; justify-content: center; }
        .game234-host .shape-icon { font-size: 24px; margin: 0 10px; }
        .game234-host .operator { font-size: 40px; margin: 5px 0; font-weight: bold; color: #2c3e50; }
        .game234-host .number-options { display: flex; justify-content: space-around; width: 60%; }
        .game234-host .number-option { width: 40px; height: 40px; display: flex; justify-content: center; align-items: center; background-color: #70a1ff; color: white; border-radius: 50%; font-size: 20px; cursor: pointer; user-select: none; transition: transform 0.2s, background-color 0.2s; }
        .game234-host .number-option:hover, .game234-host .number-option:active { transform: scale(1.1); background-color: #1e90ff; }
        .game234-host .number-option.selected { background-color: #27ae60; transform: scale(1.1); }
        .game234-host .number-option.wrong { background-color: #e74c3c; animation: game23-shake 0.5s; }
        .game234-host .result-popup { position: fixed; top: 0; left: 0; width: 100%; height: 100%; display: flex; flex-direction: column; justify-content: center; align-items: center; background-color: rgba(255, 255, 255, 0.9); z-index: 100; font-size: 50px; opacity: 0; pointer-events: none; transition: opacity 0.3s; visibility: hidden; }
        .game234-host .result-popup.show { opacity: 1; pointer-events: auto; visibility: visible; }
        .game234-host .result-emoji { font-size: 120px; margin-bottom: 20px; }
        .game234-host .result-text { font-size: 36px; font-weight: bold; text-align: center; }
        .game234-host .timer { position: absolute; top: 10px; right: 10px; font-size: 28px; font-weight: bold; color: #e74c3c; background-color: rgba(255, 255, 255, 0.7); padding: 5px 15px; border-radius: 20px; min-width: 90px; text-align: center; font-family: sans-serif; }
        @keyframes game23-shake { 0%, 100% { transform: translateX(0) scale(1.1); } 20%, 60% { transform: translateX(-5px) scale(1.1); } 40%, 80% { transform: translateX(5px) scale(1.1); } }
        @media (max-width: 500px) {
            .game234-host .more-challenging-btn { font-size: 14px; padding: 8px 12px; }
            .game234-host .game-container { padding: 10px; }
            .game234-host .shape { font-size: 24px; }
            .game234-host .shape-icon { font-size: 20px; }
            .game234-host .number-option { width: 35px; height: 35px; font-size: 18px; }
            .game234-host .result-emoji { font-size: 80px; }
            .game234-host .result-text { font-size: 28px; }
            .game234-host .operator { font-size: 32px; }
            .game234-host .timer { font-size: 24px; min-width: 80px; }
        }
        #game4-host .main-container { display: flex; flex-direction: column; align-items: center; position: relative; width: 95%; max-width: 400px; background-color: #fff; padding: 20px; border-radius: 15px; box-shadow: 0 0 15px rgba(0,0,0,0.2); }
        #game4-host #pins-area { display: flex; justify-content: center; align-items: center; flex-wrap: wrap; margin-bottom: 20px; min-height: 100px; width: 100%; }
        #game4-host .pin { width: 30px; height: 30px; background-color: white; border: 2px solid black; border-radius: 50%; margin: 5px; display: flex; justify-content: center; align-items: center; font-size: 0.8em; color: transparent; transition: background-color 0.3s ease; }
        #game4-host .pin.hit { background-color: black; }
        #game4-host #bowling-ball { width: 40px; height: 40px; background-color: #d9534f; border-radius: 50%; position: absolute; bottom: 180px; left: calc(50% - 20px); z-index: 10; transition: transform 0.8s cubic-bezier(0.25, 0.1, 0.25, 1); transform: translateY(0); visibility: hidden; }
        #game4-host #equation-area { font-size: 2.5em; margin-bottom: 20px; font-weight: bold; min-height: 1.2em; }
        #game4-host #options-area { display: flex; justify-content: space-around; width: 100%; margin-bottom: 20px; }
        #game4-host .option-button { font-size: 1.8em; padding: 15px 20px; background-color: #5cb85c; color: white; border: none; border-radius: 10px; cursor: pointer; margin: 0 5px; flex-grow: 1; transition: background-color 0.2s; }
        #game4-host .option-button:hover { background-color: #4cae4c; }
        #game4-host #start-button { font-size: 1.8em; padding: 15px 30px; background-color: #007bff; color: white; border: none; border-radius: 10px; cursor: pointer; transition: background-color 0.2s; }
        #game4-host #start-button:hover { background-color: #0056b3; }
        #game4-host #start-button:disabled { background-color: #cccccc; cursor: not-allowed; }
        #game4-host .feedback-area { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.7); display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 100; text-align: center; color: white; visibility: hidden; opacity: 0; transition: opacity 0.3s ease, visibility 0s 0.3s; }
        #game4-host .feedback-area.visible { visibility: visible; opacity: 1; transition: opacity 0.3s ease; }
        #game4-host #feedback-icon { font-size: 5em; }
        #game4-host #feedback-text { font-size: 2em; margin-top: 10px; }
        #game4-host .countdown-display { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 4em; color: #aaa; background-color: rgba(255, 255, 255, 0.8); padding: 10px 20px; border-radius: 15px; z-index: 90; display: none; }
        
        /* --- 游戏 5 (水果金钱) 样式 --- */
        #game5-host .game-container { background-color: #a5d6a7; border: 5px solid #388e3c; padding: 20px; border-radius: 15px; max-width: 500px; width: 95%; text-align: center; }
        #game5-host h1 { font-size: 2em; color: #1b5e20; }
        #game5-host .player-money { font-size: 1.6em; margin-bottom: 15px; color: #1b5e20; background-color: #e8f5e9; padding:10px; border-radius:10px; display:inline-block; }
        #game5-host .items-for-sale { display: flex; justify-content: space-around; align-items: flex-start; margin-bottom: 20px; }
        #game5-host .fruit-item { text-align: center; background-color: rgba(255,255,255,0.5); padding: 10px; border-radius: 10px; width: 45%;}
        #game5-host .fruit-icon { font-size: 3.5em; margin-bottom: 5px; }
        #game5-host .fruit-price { font-size: 1.4em; font-weight: bold; color: #c62828; }
        #game5-host .purchase-question { font-size: 1.5em; margin-bottom: 20px; color: #3e2723; }
        #game5-host .choice-options { display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 10px; width: 100%; }
        #game5-host .choice-option { background-color: #ff8f00; color: white; padding: 15px; border-radius: 10px; font-size: 1.2em; cursor: pointer; transition: transform 0.2s, background-color 0.2s; text-align: center; }
        #game5-host .choice-option:hover { transform: scale(1.03); background-color: #e65100; }
        #game5-host .game-result-popup { position: fixed; top: 0; left: 0; width: 100%; height: 100%; display: flex; flex-direction: column; justify-content: center; align-items: center; background-color: rgba(255, 255, 255, 0.95); z-index: 100; font-size: 50px; opacity: 0; pointer-events: none; transition: opacity 0.3s; visibility: hidden; }
        #game5-host .game-result-popup.show { opacity: 1; pointer-events: auto; visibility: visible; }
        #game5-host .game-result-emoji { font-size: 100px; margin-bottom: 20px; animation: game5-emoji-pop 0.5s ease-out; }
        #game5-host .game-result-text { font-size: 32px; font-weight: bold; text-align: center; }
        @keyframes game5-emoji-pop { 0% {transform: scale(0.5); opacity:0;} 70% {transform: scale(1.1); opacity:1;} 100% {transform: scale(1); opacity:1;} }
        #game5-host .score-area { display: flex; justify-content: space-between; width: 100%; max-width: 550px; margin-bottom: 15px; font-size: 18px; font-weight: bold; padding: 0 10px; }
        #game5-host .score-area span { background-color: rgba(255,255,255,0.85); padding: 8px 12px; border-radius: 10px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
        @media (max-width: 500px) {
            #game5-host .player-money {font-size: 1.3em;}
            #game5-host .fruit-icon { font-size: 3em; }
            #game5-host .purchase-question { font-size: 1.2em;}
            #game5-host .choice-option { font-size: 1em; padding: 12px;}
        }

        /* --- 游戏 6 (外星人跳跃) 样式 --- */
        #game6-host .game-container { background: linear-gradient(145deg, #1f1f3d, #1a1a33); border: 3px solid #7f00ff; padding: 20px; border-radius: 25px; box-shadow: 0 0 25px rgba(127, 0, 255, 0.6); max-width: 500px; width: 95%; text-align: center; position: relative; color: #f0f0f0;}
        #game6-host .mission-info { font-size: 1.3em; margin-bottom: 15px; background-color: rgba(255,255,255,0.05); padding:10px; border-radius: 10px; border: 1px solid rgba(127, 0, 255,0.3); }
        #game6-host .number-path-container { margin-top: 10px; margin-bottom: 20px; background-color: rgba(0,0,0,0.4); padding: 8px; border-radius: 8px; overflow-x: auto; white-space: nowrap; border: 1px solid rgba(127, 0, 255,0.2); scrollbar-width: thin; scrollbar-color: #7f00ff #0a0a23; }
        #game6-host .number-path-container::-webkit-scrollbar { height: 8px; }
        #game6-host .number-path-container::-webkit-scrollbar-track { background: #0a0a23; border-radius: 4px;}
        #game6-host .number-path-container::-webkit-scrollbar-thumb { background-color: #7f00ff; border-radius: 4px; border: 2px solid #0a0a23;}
        #game6-host .path-segment { display: inline-block; padding: 5px 8px; margin: 0 2px; background-color: #30304d; color: #c0c0e0; border-radius: 5px; font-size: 0.9em; font-weight: bold; transition: transform 0.2s, background-color 0.2s; }
        #game6-host .path-segment.current { background-color: #ffdf00; color: #222; transform: scale(1.1); box-shadow: 0 0 10px #ffdf00; }
        #game6-host .path-segment.target { background-color: #00ff99; color: #111; transform: scale(1.1); box-shadow: 0 0 10px #00ff99; }
        #game6-host .alien-status { display: flex; justify-content: space-around; align-items: center; margin-bottom: 20px; padding: 10px; background-color: rgba(0,0,0,0.3); border-radius: 10px; }
        #game6-host .alien-icon { font-size: 3.5em; animation: game6-float 2.5s infinite ease-in-out; }
        @keyframes game6-float { 0%, 100% {transform: translateY(0);} 50% {transform: translateY(-10px);} }
        #game6-host .position-text, #game6-host .target-text { font-size: 1.2em; font-weight: bold; padding: 5px; }
        #game6-host .position-text { color: #ffdf00; }
        #game6-host .target-text { color: #00ff99; }
        #game6-host .question-text{ font-size: 1.5em; margin-bottom: 20px; font-weight: bold; }
        #game6-host .jump-options { display: grid; grid-template-columns: repeat(auto-fit, minmax(90px, 1fr)); gap: 12px; width: 100%; }
        #game6-host .jump-option { background-color: #6200ea; color: white; padding: 16px; border-radius: 10px; font-size: 1.5em; font-weight: bold; cursor: pointer; transition: transform 0.2s, background-color 0.2s, box-shadow 0.2s; border: 2px solid transparent; }
        #game6-host .jump-option:hover { transform: translateY(-3px) scale(1.03); background-color: #7c4dff; box-shadow: 0 4px 15px rgba(98, 0, 234, 0.5); border-color: #b388ff; }
        #game6-host .jump-option:active { transform: translateY(1px); }
        #game6-host .result-popup { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.9); display: none; flex-direction: column; justify-content: center; align-items: center; z-index: 1000; opacity: 0; transition: opacity 0.3s ease-in-out; }
        #game6-host .result-popup.show { display: flex; opacity: 1; }
        #game6-host .result-content { background: linear-gradient(135deg, #311b92, #4527a0); padding: 25px 35px; border-radius: 18px; text-align: center; color: white; box-shadow: 0 0 30px rgba(127, 0, 255,0.8); border: 2px solid #7f00ff; transform: scale(0.7); opacity: 0; animation: game6-popup-appear 0.4s 0.1s forwards cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        @keyframes game6-popup-appear { to { transform: scale(1); opacity: 1; } }
        #game6-host .result-emoji { font-size: 4.5em; margin-bottom: 15px; }
        #game6-host .result-text { font-size: 1.8em; font-weight: bold; margin-bottom: 20px; }
        #game6-host .next-button { background-color: #fdd835; color: #333; padding: 10px 22px; border: none; border-radius: 8px; font-size: 1.1em; font-weight: bold; cursor: pointer; transition: background-color 0.2s, transform 0.2s; }
        #game6-host .next-button:hover { background-color: #ffee58; transform: scale(1.05); }
        #game6-host .score-board { position: absolute; top: 10px; right: 10px; background-color: rgba(0,0,0,0.6); padding: 6px 10px; border-radius: 6px; font-size: 1em; color: #b388ff; border: 1px solid #7f00ff; }
        @media (max-width: 450px) {
            #game6-host .game-container { padding: 15px; max-width: 100%;}
            #game6-host .mission-info { font-size: 1.1em; padding: 8px;}
            #game6-host .alien-icon { font-size: 3em; }
            #game6-host .position-text, #game6-host .target-text { font-size: 1em; }
            #game6-host .question-text { font-size: 1.2em; }
            #game6-host .jump-option { font-size: 1.2em; padding: 14px; }
            #game6-host .path-segment { font-size: 0.8em; padding: 4px 6px;}
            #game6-host .result-emoji { font-size: 3.5em; }
            #game6-host .result-text { font-size: 1.3em; }
            #game6-host .next-button { font-size: 1em; padding: 8px 18px;}
        }

        /* --- 游戏 7 (超级英雄数学) 样式 --- */
        #game7-host { background: linear-gradient(to-br, #e0f7fa, #d1e6f6); width: 100%; }
        #game7-host .container { max-width: 800px; margin: auto; padding: 1rem; }
        #game7-host .game-card { background-color: white; border-radius: 1.5rem; box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1); padding: 1.5rem 2rem; margin-bottom: 2rem;}
        #game7-host .stats-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; }
        #game7-host .stat-item { display: flex; align-items: center; }
        #game7-host .stat-icon { background-color: rgba(22, 93, 255, 0.1); border-radius: 9999px; padding: 0.5rem; margin-right: 0.75rem; color: #165DFF; }
        #game7-host .stat-icon.yellow { background-color: rgba(255, 221, 0, 0.2); color: #f59e0b; }
        #game7-host .stat-icon.red { background-color: rgba(255, 77, 79, 0.1); color: #FF4D4F; }
        #game7-host .stat-label { color: rgba(29, 33, 41, 0.6); font-size: 0.875rem; }
        #game7-host .stat-value { font-weight: bold; }
        #game7-host .question-box { text-align: center; margin: 3rem 0; }
        #game7-host .question-prompt { color: rgba(29, 33, 41, 0.7); margin-bottom: 0.5rem; }
        #game7-host .math-question { font-size: clamp(2.5rem, 8vw, 4rem); font-weight: bold; color: #165DFF; margin-bottom: 1.5rem; text-shadow: 0 0 8px rgba(255, 255, 0, 0.8); }
        #game7-host .answer-input { width: 100%; max-width: 16rem; padding: 1rem 1.5rem; border-radius: 0.75rem; border: 2px solid rgba(22, 93, 255, 0.3); outline: none; text-align: center; font-size: 1.5rem; font-weight: bold; transition: all 0.2s; }
        #game7-host .answer-input:focus { border-color: #165DFF; box-shadow: 0 0 0 4px rgba(22, 93, 255, 0.1); }
        #game7-host .submit-button { background-color: #FF7D00; color: white; font-weight: bold; padding: 0.75rem 2rem; border-radius: 9999px; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); transition: all 0.2s; cursor: pointer; border: none; display: flex; align-items: center; margin: 1.5rem auto 0; }
        #game7-host .submit-button:active { transform: scale(0.95); }
        #game7-host .progress-section h3 { font-weight: bold; font-size: 1.125rem; margin-bottom: 1rem; text-align: left;}
        #game7-host .character-card { background-color: #f8f9fa; border-radius: 0.75rem; padding: 1rem; display: flex; align-items: center; margin-bottom: 0.75rem; }
        #game7-host .character-img { width: 5rem; height: 5rem; border-radius: 9999px; overflow: hidden; margin-right: 1rem; object-fit: cover; }
        #game7-host .progress-bar-bg { width: 100%; background-color: #e9ecef; border-radius: 9999px; height: 0.625rem; margin-top: 0.5rem; }
        #game7-host .progress-bar-fill { height: 100%; border-radius: 9999px; transition: width 0.5s; }
        #game7-host .superman-progress { background-color: #165DFF; }
        #game7-host .bumblebee-progress { background-color: #FF7D00; }
        #game7-host .ironman-progress { background-color: #FF4D4F; }
        #game7-host .feedback-modal { position: fixed; inset: 0; background-color: rgba(0, 0, 0, 0.5); display: flex; align-items: center; justify-content: center; z-index: 50; visibility: hidden; opacity: 0; transition: opacity 0.3s, visibility 0s 0.3s; }
        #game7-host .feedback-modal.show { visibility: visible; opacity: 1; transition: opacity 0.3s; }
        #game7-host .modal-content { background-color: white; border-radius: 1.5rem; box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04); padding: 2rem; max-width: 28rem; width: 90%; text-align: center; transform: scale(0.95); opacity: 0; transition: transform 0.3s, opacity 0.3s; }
        #game7-host .feedback-modal.show .modal-content { transform: scale(1); opacity: 1; }
        #game7-host .modal-icon-wrapper { width: 5rem; height: 5rem; border-radius: 9999px; display: flex; align-items: center; justify-content: center; margin: 0 auto 1rem; }
        #game7-host .modal-icon-wrapper.correct { background-color: rgba(76, 175, 80, 0.1); color: #4CAF50; }
        #game7-host .modal-icon-wrapper.wrong { background-color: rgba(244, 67, 54, 0.1); color: #F44336; }
        #game7-host .modal-icon { font-size: 2.5rem; }
        #game7-host .modal-title { font-size: 1.5rem; font-weight: bold; margin-bottom: 0.5rem; }
        #game7-host .modal-title.correct { color: #4CAF50; }
        #game7-host .modal-title.wrong { color: #F44336; }
        #game7-host .modal-text { color: rgba(29, 33, 41, 0.7); margin-bottom: 1.5rem; }
        #game7-host .modal-button { width: 100%; font-weight: bold; padding: 0.75rem 2rem; border-radius: 9999px; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); transition: all 0.2s; cursor: pointer; border: none; }
        #game7-host .modal-button.correct { background-color: #165DFF; color: white; }
        #game7-host .modal-button.wrong { background-color: #165DFF; color: white; }
        #game7-host .modal-button:active { transform: scale(0.95); }

        /* --- 游戏 8 (儿童算术) 样式 --- */
        #game8-host .game-container { max-width: 600px; margin: 0 auto; background-color: white; border-radius: 20px; box-shadow: 0 0 20px rgba(0, 0, 0, 0.1); padding: 20px; }
        #game8-host h1 { color: #ff6b6b; margin-bottom: 30px; }
        #game8-host .game-area { margin: 30px 0; }
        #game8-host .problem { font-size: 36px; margin: 20px 0; color: #5c7cfa; }
        #game8-host .options { display: flex; flex-wrap: wrap; justify-content: center; gap: 15px; margin: 20px 0; }
        #game8-host .option { background-color: #74c0fc; color: white; border: none; border-radius: 50%; width: 80px; height: 80px; font-size: 24px; cursor: pointer; transition: transform 0.2s, background-color 0.2s; }
        #game8-host .option:hover { transform: scale(1.1); background-color: #4dabf7; }
        #game8-host .option:disabled { cursor: not-allowed; }
        #game8-host .score { font-size: 24px; margin-top: 20px; color: #495057; }
        #game8-host .message { height: 50px; font-size: 28px; margin: 20px 0; font-weight: bold; }
        #game8-host .message.correct { color: #40c057; }
        #game8-host .message.wrong { color: #fa5252; }
        #game8-host .controls { margin-top: 30px; }
        #game8-host .btn { background-color: #ff8787; color: white; border: none; border-radius: 30px; padding: 10px 20px; font-size: 18px; cursor: pointer; margin: 0 10px; transition: background-color 0.2s; }
        #game8-host .btn:hover { background-color: #ff6b6b; }
        #game8-host .settings { margin: 20px 0; text-align: center; padding: 0 20px; }
        #game8-host .operation-toggle { margin: 10px 0; }
        #game8-host label { margin: 0 10px; font-size: 18px; cursor: pointer; }
        #game8-host .stars { margin: 20px 0; font-size: 30px; color: #fcc419; }
        #game8-host .celebration { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 100; display: none; }
        #game8-host .confetti { position: absolute; width: 10px; height: 10px; background-color: #f76707; border-radius: 50%; }

        /* --- 游戏 9 (20以内加减) & 游戏 10 (视觉数学) 共享样式 --- */
        .game910-host .game-container { max-width: 600px; margin: auto; padding: 20px; background-color: #FFFFFF; border-radius: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); border: 1px solid #ccc; }
        .game910-host h1 { color: #FF6B6B; font-size: 2.2em; }
        .game910-host .problem-area { font-size: 2.5em; margin-bottom: 20px; color: #333; min-height: 80px; display: flex; align-items: center; justify-content: center; }
        .game910-host .problem-area span { padding: 10px; }
        .game910-host .answer-options button { background-color: #7986CB; color: white; border: none; border-radius: 15px; padding: 15px 20px; font-size: 1.8em; margin: 10px; cursor: pointer; transition: background-color 0.2s, transform 0.2s; }
        .game910-host .answer-options button:hover, .game910-host .answer-options button:active { background-color: #5C6BC0; transform: scale(1.05); }
        .game910-host .answer-options button:disabled { background-color: #9fa8da; cursor: not-allowed; transform: none; }
        .game910-host .timer-area, .game910-host .score-area { margin-bottom: 15px; font-size: 1.3em; color: #555; }
        .game910-host .controls button, .game910-host .timer-controls button { background-color: #4DB6AC; color: white; border: none; border-radius: 10px; padding: 10px 18px; font-size: 1.2em; margin: 5px; cursor: pointer; transition: background-color 0.2s, transform 0.2s; }
        .game910-host .controls button:hover, .game910-host .controls button:active, .game910-host .timer-controls button:hover, .game910-host .timer-controls button:active { background-color: #26A69A; transform: scale(1.03); }
        .game910-host .timer-controls { display: flex; align-items: center; justify-content: center; margin-bottom: 20px; font-size: 1.1em; }
        .game910-host .timer-controls span { margin-right: 10px; }
        .game910-host .timer-value { font-weight: bold; color: #00796B; }
        .game910-host .timer-controls button { font-size: 1em; padding: 5px 10px; }
        .game910-host .timer-controls button:disabled { background-color: #80cbc4; cursor: not-allowed; transform: none;}
        .game910-host .message-area { min-height: 30px; margin-top: 15px; font-weight: bold; font-size: 1.2em; }
        .game910-host .message-area .correct { color: #4CAF50; }
        .game910-host .message-area .incorrect { color: #F44336; }
        .game910-host .next-question { background-color: #FF8F00; }
        .game910-host .next-question:hover, .game910-host .next-question:active { background-color: #FF6F00; }
        @media (max-width: 600px) {
            .game910-host .game-container { padding: 15px; margin: 10px 0; }
            .game910-host h1 { font-size: 1.8em; }
            .game910-host .problem-area { font-size: 2em; min-height: 60px; }
            .game910-host .answer-options button { font-size: 1.5em; padding: 12px 15px; margin: 8px; }
            .game910-host .timer-area, .game910-host .score-area { font-size: 1.1em; }
            .game910-host .controls button, .game910-host .timer-controls button { font-size: 1em; padding: 8px 12px; }
            .game910-host .timer-controls button { font-size: 0.9em; padding: 4px 8px; }
            .game910-host .message-area { font-size: 1em; }
        }
        
        /* --- 游戏 10 (视觉数学) 特定样式 --- */
        #game10-host .problem-area { min-height: 100px; }
        #game10-host .theme-selector { display: flex; align-items: center; justify-content: center; margin-bottom: 15px; gap: 10px; }
        #game10-host .theme-selector span { font-size: 1.1em; }
        #game10-host .theme-selector button { background-color: #607D8B; color: white; border: none; border-radius: 5px; padding: 8px 12px; font-size: 0.9em; cursor: pointer; transition: background-color 0.2s; }
        #game10-host .theme-selector button:hover { background-color: #546E7A; }
        #game10-host .theme-selector button.active-theme { background-color: #FFC107; font-weight: bold; color: #333; }
        #game10-host .times-symbol { margin: 0 0.2em; font-weight: bold; }

    </style>
</head>
<body>
    <div class="main-container">
        <div id="game-selector-area">
            <button id="select-game1">1</button>
            <button id="select-game2">2</button>
            <button id="select-game3">3</button>
            <button id="select-game4">4</button>
            <button id="select-game5">5</button>
            <button id="select-game6">6</button>
            <button id="select-game7">7</button>
            <button id="select-game8">8</button>
            <button id="select-game9">9</button>
            <button id="select-game10">10</button>
        </div>

        <div id="game-content-area">
            <!-- Game 1 Host -->
            <div id="game1-host" class="game-host-container" style="display: none;">
                <div class="game-container">
                    <h1>这里有多少个图形？</h1>
                    <div class="cheer">加油，Kris！</div>
                    <div class="timer" id="game1-timer">2</div>
                    <div class="shapes-container" id="game1-shapes-container"></div>
                    <div class="numbers" id="game1-numbers"></div>
                    <div class="message" id="game1-message"></div>
                    <div class="score">得分: <span id="game1-score">0</span></div>
                    <div class="stars" id="game1-stars"></div>
                    <div class="progress-bar">
                        <div class="progress" id="game1-progress"></div>
                    </div>
                </div>
                <div class="celebration" id="game1-celebration"></div>
            </div>

            <!-- Game 2 Host -->
            <div id="game2-host" class="game-host-container game234-host" style="display: none;">
                <button class="more-challenging-btn" id="game2-more-challenging-btn">更具挑战性</button>
                <div class="game-container">
                    <div class="timer" id="game2-timer">10:00</div>
                    <div class="shapes-container">
                        <div class="shape-group" id="game2-shape-group-1"></div>
                        <div class="shape-group" id="game2-shape-group-2"></div>
                    </div>
                    <div class="math-container">
                        <div class="math-row">
                            <div class="shape-icon" id="game2-icon-1"></div>
                            <div class="number-options" id="game2-options-1"></div>
                        </div>
                        <div class="math-row"><div class="operator">+</div></div>
                        <div class="math-row">
                            <div class="shape-icon" id="game2-icon-2"></div>
                            <div class="number-options" id="game2-options-2"></div>
                        </div>
                        <div class="math-row"><div class="operator">=</div></div>
                        <div class="math-row">
                            <div class="number-options" id="game2-options-sum"></div>
                        </div>
                    </div>
                </div>
                <div class="result-popup" id="game2-result-popup">
                    <div class="result-emoji" id="game2-result-emoji"></div>
                    <div class="result-text" id="game2-result-text"></div>
                </div>
            </div>

            <!-- Game 3 Host -->
            <div id="game3-host" class="game-host-container game234-host" style="display: none;">
                <button class="more-challenging-btn" id="game3-more-challenging-btn">更具挑战性</button>
                <div class="game-container">
                    <div class="timer" id="game3-timer">10:00</div>
                    <div class="shapes-container">
                        <div class="shape-group" id="game3-mixed-shapes-group"></div>
                    </div>
                    <div class="math-container">
                        <div class="math-row">
                            <div class="shape-icon" id="game3-icon-1"></div>
                            <div class="number-options" id="game3-options-1"></div>
                        </div>
                        <div class="math-row"><div class="operator">+</div></div>
                        <div class="math-row">
                            <div class="shape-icon" id="game3-icon-2"></div>
                            <div class="number-options" id="game3-options-2"></div>
                        </div>
                        <div class="math-row"><div class="operator">=</div></div>
                        <div class="math-row">
                            <div class="number-options" id="game3-options-sum"></div>
                        </div>
                    </div>
                </div>
                <div class="result-popup" id="game3-result-popup">
                    <div class="result-emoji" id="game3-result-emoji"></div>
                    <div class="result-text" id="game3-result-text"></div>
                </div>
            </div>

            <!-- Game 4 Host -->
            <div id="game4-host" class="game-host-container game234-host" style="display: none;">
                <div class="main-container" id="game4-main-container">
                    <div class="countdown-display" id="game4-countdown-display">3</div>
                    <div id="pins-area"></div>
                    <div id="bowling-ball"></div>
                    <div id="equation-area">
                        <span id="game4-n-value">N</span>
                        <span> - </span>
                        <span id="game4-m-value"></span>
                        <span> = </span>
                        <span id="game4-q-mark">?</span>
                    </div>
                    <div id="options-area"></div>
                    <button id="start-button">开始</button>
                </div>
                <div class="feedback-area" id="game4-feedback-area">
                    <div id="feedback-icon"></div>
                    <div id="feedback-text"></div>
                </div>
            </div>
            
             <!-- Game 5 Host -->
            <div id="game5-host" class="game-host-container" style="display: none;">
                <div class="game-container">
                    <h1>水果摊游戏</h1>
                    <div class="score-area">
                        <span id="game5-tries-display">尝试次数: 50</span>
                        <span id="game5-score-display">得分: 0</span>
                    </div>
                    <div id="game5-player-money" class="player-money">你有 💰10个金币。</div>
                    <div class="items-for-sale">
                        <div class="fruit-item" id="game5-item1-details">
                            <div id="game5-fruit1-icon" class="fruit-icon">🍎</div>
                            <div id="game5-fruit1-name">苹果</div>
                            <div id="game5-fruit1-price" class="fruit-price">3 金币</div>
                        </div>
                        <div class="fruit-item" id="game5-item2-details">
                            <div id="game5-fruit2-icon" class="fruit-icon">🍌</div>
                            <div id="game5-fruit2-name">香蕉</div>
                            <div id="game5-fruit2-price" class="fruit-price">4 金币</div>
                        </div>
                    </div>
                    <div id="game5-purchase-question" class="purchase-question">你能买什么？</div>
                    <div id="game5-choice-options" class="choice-options"></div>
                </div>
                <div class="game-result-popup" id="game5-result-popup">
                    <div class="game-result-emoji" id="game5-result-emoji"></div>
                    <div class="game-result-text" id="game5-result-text"></div>
                </div>
            </div>
            
            <!-- Game 6 Host -->
            <div id="game6-host" class="game-host-container" style="display: none;">
                 <div class="game-container">
                    <div class="score-board" id="game6-score-board">得分: 0</div>
                    <div class="mission-info">
                        帮助外星人跳回目标星球！
                        <div class="number-path-container" id="game6-number-path"></div>
                    </div>
                    <div class="alien-status">
                        <span class="alien-icon">🚀</span>
                        <div>
                            <div class="position-text" id="game6-current-pos">外星人位置: 10</div>
                            <div class="target-text" id="game6-target-pos">目标星球: 7</div>
                        </div>
                        <span class="alien-icon">🌍</span>
                    </div>
                    <div class="question-text">需要跳几步才能到星球？</div>
                    <div class="jump-options" id="game6-jump-options"></div>
                </div>
                <div class="result-popup" id="game6-result-popup">
                    <div class="result-content">
                        <div id="game6-result-emoji" class="result-emoji">🎉</div>
                        <div id="game6-result-text" class="result-text">正确!</div>
                        <button id="game6-next-button" class="next-button">下一程</button>
                    </div>
                </div>
            </div>

            <!-- Game 7 Host -->
            <div id="game7-host" class="game-host-container" style="display: none;">
                <div class="container">
                    <div class="game-card">
                        <div class="stats-bar">
                            <div class="stat-item">
                                <div class="stat-icon"><i class="fa-solid fa-shield"></i></div>
                                <div>
                                    <p class="stat-label">等级</p>
                                    <p class="stat-value" id="game7-level-display">1</p>
                                </div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-icon yellow"><i class="fa-solid fa-star"></i></div>
                                <div>
                                    <p class="stat-label">分数</p>
                                    <p class="stat-value" id="game7-score-display">0</p>
                                </div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-icon red"><i class="fa-solid fa-heart"></i></div>
                                <div>
                                    <p class="stat-label">生命</p>
                                    <p class="stat-value" id="game7-lives-display">3</p>
                                </div>
                            </div>
                        </div>
                        <div class="question-box">
                            <p class="question-prompt">快回答，小英雄！</p>
                            <div class="math-question" id="game7-math-question">3 + 5 = ?</div>
                            <input type="number" id="game7-answer-input" class="answer-input" placeholder="输入答案">
                        </div>
                         <button id="game7-submit-answer" class="submit-button">
                            <i class="fa-solid fa-check mr-2"></i> 提交答案
                        </button>
                    </div>

                    <div class="progress-section">
                        <h3>可解锁的英雄</h3>
                        <div class="character-card">
                            <img src="https://picsum.photos/seed/superman1/100/100" alt="英雄 1" class="character-img">
                            <div>
                                <h4>超人克拉克</h4>
                                <p id="game7-superman-status" style="font-size:0.9em; color:#555;">得分100解锁</p>
                                <div class="progress-bar-bg">
                                    <div id="game7-superman-progress" class="progress-bar-fill superman-progress" style="width: 0%"></div>
                                </div>
                            </div>
                        </div>
                        <div class="character-card">
                            <img src="https://picsum.photos/seed/transformer1/100/100" alt="英雄 2" class="character-img">
                             <div>
                                <h4>大黄蜂</h4>
                                <p id="game7-bumblebee-status" style="font-size:0.9em; color:#555;">得分200解锁</p>
                                <div class="progress-bar-bg">
                                    <div id="game7-bumblebee-progress" class="progress-bar-fill bumblebee-progress" style="width: 0%"></div>
                                </div>
                            </div>
                        </div>
                        <div class="character-card">
                            <img src="https://picsum.photos/seed/hero/100/100" alt="英雄 3" class="character-img">
                            <div>
                                <h4>钢铁侠</h4>
                                <p id="game7-ironman-status" style="font-size:0.9em; color:#555;">得分400解锁</p>
                                <div class="progress-bar-bg">
                                    <div id="game7-ironman-progress" class="progress-bar-fill ironman-progress" style="width: 0%"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Feedback Modals for Game 7 -->
                <div id="game7-correct-feedback" class="feedback-modal">
                    <div class="modal-content">
                        <div class="modal-icon-wrapper correct"><i class="fa-solid fa-check modal-icon"></i></div>
                        <h3 class="modal-title correct">太棒了！</h3>
                        <p class="modal-text">回答正确！你获得了20分！</p>
                        <button id="game7-next-question" class="modal-button correct">下一题 <i class="fa-solid fa-arrow-right ml-2"></i></button>
                    </div>
                </div>
                <div id="game7-wrong-feedback" class="feedback-modal">
                     <div class="modal-content">
                        <div class="modal-icon-wrapper wrong"><i class="fa-solid fa-times modal-icon"></i></div>
                        <h3 class="modal-title wrong">再试一次！</h3>
                        <p class="modal-text">正确答案是 <span id="game7-correct-answer-display" style="font-weight:bold;">8</span>。别灰心！</p>
                        <button id="game7-try-again" class="modal-button wrong">继续挑战 <i class="fa-solid fa-redo ml-2"></i></button>
                    </div>
                </div>
                 <div id="game7-game-over-screen" class="feedback-modal">
                    <div class="modal-content">
                        <div class="modal-icon-wrapper correct"><i class="fa-solid fa-trophy modal-icon"></i></div>
                        <h3 class="modal-title correct">游戏结束！</h3>
                        <p class="modal-text" style="font-size: 1.5rem; font-weight: bold;">最终得分: <span id="game7-final-score">0</span></p>
                        <button id="game7-play-again" class="modal-button correct">再玩一次 <i class="fa-solid fa-refresh ml-1"></i></button>
                    </div>
                </div>
            </div>

            <!-- Game 8 Host -->
            <div id="game8-host" class="game-host-container" style="display: none;">
                <div class="game-container">
                    <h1>儿童算术游戏</h1>
                    <div class="settings">
                        <div class="operation-toggle">
                            <label><input type="checkbox" id="game8-addition" checked> 加法</label>
                            <label><input type="checkbox" id="game8-subtraction" checked> 减法</label>
                            <label><input type="checkbox" id="game8-multiplication" checked> 乘法</label>
                        </div>
                    </div>
                    <div class="game-area">
                        <div class="problem" id="game8-problem">6 + 3 = ?</div>
                        <div class="options" id="game8-options"></div>
                        <div class="message" id="game8-message"></div>
                    </div>
                    <div class="score">得分: <span id="game8-score">0</span></div>
                    <div class="stars" id="game8-stars"></div>
                    <div class="controls">
                        <button class="btn" id="game8-next-btn">下一题</button>
                    </div>
                </div>
                <div class="celebration" id="game8-celebration"></div>
            </div>

            <!-- Game 9 Host -->
            <div id="game9-host" class="game-host-container game910-host" style="display: none;">
                <div class="game-container">
                    <h1>20以内加减法</h1>
                    <div class="timer-controls">
                        <span>时间限制: <span class="timer-value" id="game9-timer-value">10</span>s</span>
                        <button id="game9-decrease-timer">-</button>
                        <button id="game9-increase-timer">+</button>
                    </div>
                    <div class="problem-area">
                        <span id="game9-problem-display">点击“开始游戏”</span>
                    </div>
                    <div class="answer-options">
                        <button id="game9-ans1"></button>
                        <button id="game9-ans2"></button>
                        <button id="game9-ans3"></button>
                    </div>
                    <div class="timer-area">
                        剩余时间: <span id="game9-time-left">N/A</span>
                    </div>
                    <div class="score-area">
                        得分: <span id="game9-score">0</span>
                    </div>
                    <div class="message-area">
                        <span id="game9-feedback-message"></span>
                    </div>
                    <div class="controls">
                        <button id="game9-start-game">开始游戏</button>
                        <button class="next-question" id="game9-next-question" style="display:none;">下一题</button>
                    </div>
                </div>
            </div>
            
            <!-- Game 10 Host -->
            <div id="game10-host" class="game-host-container game910-host" style="display: none;">
                 <div class="game-container">
                    <h1>趣味视觉数学</h1>
                    <div class="timer-controls">
                        <span>时间限制: <span class="timer-value" id="game10-timer-value">10</span>s</span>
                        <button id="game10-decrease-timer">-</button>
                        <button id="game10-increase-timer">+</button>
                    </div>
                    <div class="theme-selector">
                        <span>选择主题:</span>
                        <button id="game10-theme-matchsticks">火柴棒</button>
                        <button id="game10-theme-chicks">小鸡</button>
                    </div>
                    <div class="problem-area">
                        <span id="game10-problem-display">点击“开始游戏”</span>
                    </div>
                    <div class="answer-options">
                        <button id="game10-ans1"></button>
                        <button id="game10-ans2"></button>
                        <button id="game10-ans3"></button>
                    </div>
                    <div class="timer-area">
                        剩余时间: <span id="game10-time-left">N/A</span>
                    </div>
                    <div class="score-area">
                        得分: <span id="game10-score">0</span>
                    </div>
                    <div class="message-area">
                        <span id="game10-feedback-message"></span>
                    </div>
                    <div class="controls">
                        <button id="game10-start-game">开始游戏</button>
                        <button class="next-question" id="game10-next-question" style="display:none;">下一题</button>
                    </div>
                </div>
            </div>

        </div>
    </div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    
    // --- 主应用控制器 ---
    const app = {
        activeGame: null,
        gameHosts: {
            game1: document.getElementById('game1-host'),
            game2: document.getElementById('game2-host'),
            game3: document.getElementById('game3-host'),
            game4: document.getElementById('game4-host'),
            game5: document.getElementById('game5-host'),
            game6: document.getElementById('game6-host'),
            game7: document.getElementById('game7-host'),
            game8: document.getElementById('game8-host'),
            game9: document.getElementById('game9-host'),
            game10: document.getElementById('game10-host')
        },
        gameModules: {}, // 将由游戏对象填充
        selectorButtons: {
            game1: document.getElementById('select-game1'),
            game2: document.getElementById('select-game2'),
            game3: document.getElementById('select-game3'),
            game4: document.getElementById('select-game4'),
            game5: document.getElementById('select-game5'),
            game6: document.getElementById('select-game6'),
            game7: document.getElementById('select-game7'),
            game8: document.getElementById('select-game8'),
            game9: document.getElementById('select-game9'),
            game10: document.getElementById('select-game10')
        },
        
        init: function() {
            this.gameModules = { game1, game2, game3, game4, game5, game6, game7, game8, game9, game10 };
            Object.keys(this.selectorButtons).forEach(key => {
                this.selectorButtons[key].addEventListener('click', () => this.switchGame(key));
            });
            this.switchGame('game1'); // 从游戏1开始
        },

        switchGame: function(gameKey) {
            // 清理上一个游戏
            if (this.activeGame && this.activeGame.cleanup) {
                this.activeGame.cleanup();
            }

            // 隐藏所有游戏界面
            Object.values(this.gameHosts).forEach(host => host.style.display = 'none');
            
            // 取消所有选择器按钮的激活状态
            Object.values(this.selectorButtons).forEach(btn => btn.classList.remove('active'));

            // 显示并激活所选的游戏
            this.gameHosts[gameKey].style.display = 'flex';
            this.selectorButtons[gameKey].classList.add('active');
            
            this.activeGame = this.gameModules[gameKey];
            if (this.activeGame && this.activeGame.init) {
                this.activeGame.init();
            }
        }
    };

    // --- 工具函数 ---
    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
    }
    function getRandomInt(min, max) {
        return Math.floor(Math.random() * (max - min + 1)) + min;
    }

    // --- 游戏 1 (数图形) 逻辑 ---
    const game1 = {
        id: 'game1',
        hostElement: document.getElementById('game1-host'),
        state: { score: 0, currentCount: 0, timerValue: 2, timerInterval: null, level: 1, playing: false },
        elements: {},
        shapes: [
            `<svg viewBox="0 0 100 100"><circle cx="50" cy="50" r="40" fill="#ff6b6b" /></svg>`,
            `<svg viewBox="0 0 100 100"><rect x="10" y="10" width="80" height="80" fill="#5c7cfa" /></svg>`,
            `<svg viewBox="0 0 100 100"><polygon points="50,10 90,90 10,90" fill="#40c057" /></svg>`,
            `<svg viewBox="0 0 100 100"><polygon points="50,10 61,35 90,40 70,60 75,90 50,75 25,90 30,60 10,40 39,35" fill="#fcc419" /></svg>`,
            `<svg viewBox="0 0 100 100"><path d="M50,80 C35,65 10,50 10,30 C10,15 25,10 35,10 C45,10 50,20 50,20 C50,20 55,10 65,10 C75,10 90,15 90,30 C90,50 65,65 50,80 Z" fill="#f06595" /></svg>`
        ],
        init() {
            this.elements.shapesContainer = this.hostElement.querySelector('#game1-shapes-container');
            this.elements.numbersContainer = this.hostElement.querySelector('#game1-numbers');
            this.elements.messageElement = this.hostElement.querySelector('#game1-message');
            this.elements.scoreElement = this.hostElement.querySelector('#game1-score');
            this.elements.starsElement = this.hostElement.querySelector('#game1-stars');
            this.elements.timerElement = this.hostElement.querySelector('#game1-timer');
            this.elements.celebrationElement = this.hostElement.querySelector('#game1-celebration');
            this.elements.progressElement = this.hostElement.querySelector('#game1-progress');

            this.state.score = 0;
            this.state.level = 1;
            this.elements.scoreElement.textContent = '0';
            this.elements.starsElement.textContent = '';
            this.elements.progressElement.style.width = '0%';
            this.updateProgressBar();
            this.createNumberButtons();
            this.startNewRound();
        },
        createNumberButtons() {
            this.elements.numbersContainer.innerHTML = '';
            for (let i = 0; i <= 10; i++) {
                const button = document.createElement('div');
                button.className = 'number';
                button.textContent = i;
                button.addEventListener('click', () => this.checkAnswer(i));
                this.elements.numbersContainer.appendChild(button);
            }
        },
        startNewRound() {
            this.cleanup();
            this.elements.messageElement.textContent = '';
            this.elements.messageElement.className = 'message';
            this.state.currentCount = Math.random() < 0.7 ? getRandomInt(6, 10) : getRandomInt(1, 5);
            this.elements.shapesContainer.innerHTML = '';
            this.generateShapes();
            this.state.timerValue = 2;
            this.elements.timerElement.textContent = this.state.timerValue;
            this.state.playing = true;
            this.state.timerInterval = setInterval(() => {
                this.state.timerValue--;
                this.elements.timerElement.textContent = this.state.timerValue;
                if (this.state.timerValue <= 0) clearInterval(this.state.timerInterval);
            }, 1000);
        },
        generateShapes() {
            for (let i = 0; i < this.state.currentCount; i++) {
                const shapeDiv = document.createElement('div');
                shapeDiv.className = 'shape';
                shapeDiv.innerHTML = this.shapes[getRandomInt(0, this.shapes.length - 1)];
                shapeDiv.style.transform = `rotate(${getRandomInt(0, 360)}deg)`;
                this.elements.shapesContainer.appendChild(shapeDiv);
            }
        },
        checkAnswer(selectedNumber) {
            if (!this.state.playing) return;
            this.state.playing = false;
            clearInterval(this.state.timerInterval);

            if (selectedNumber === this.state.currentCount) {
                this.elements.messageElement.textContent = '答对了！';
                this.elements.messageElement.className = 'message correct';
                this.state.score++;
                this.elements.scoreElement.textContent = this.state.score;
                if (this.state.score % 3 === 0) this.state.level++;
                this.updateStars();
                this.celebrate();
                this.updateProgressBar();
                setTimeout(() => this.startNewRound(), 1500);
            } else {
                this.elements.messageElement.textContent = `哎呀！答案是 ${this.state.currentCount}`;
                this.elements.messageElement.className = 'message wrong';
                setTimeout(() => this.startNewRound(), 2000);
            }
        },
        updateStars() { this.elements.starsElement.textContent = '★'.repeat(Math.min(5, Math.floor(this.state.score / 5))); },
        updateProgressBar() { this.elements.progressElement.style.width = Math.min(100, (this.state.score / 20) * 100) + '%'; },
        celebrate() {
            this.elements.celebrationElement.style.display = 'block';
            this.elements.celebrationElement.innerHTML = '';
            for (let i = 0; i < 30; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = Math.random() * 100 + '%';
                confetti.style.top = '-10px';
                confetti.style.backgroundColor = ['#ff6b6b', '#5c7cfa', '#40c057', '#fcc419', '#7950f2'][getRandomInt(0, 4)];
                this.elements.celebrationElement.appendChild(confetti);
                const animation = confetti.animate([ { top: '-10px' }, { top: '110%' } ], { duration: 1000 + Math.random() * 1000, easing: 'ease-in' });
                animation.onfinish = () => {
                    confetti.remove();
                    if (this.elements.celebrationElement.children.length === 0) this.elements.celebrationElement.style.display = 'none';
                };
            }
        },
        cleanup() {
            if (this.state.timerInterval) clearInterval(this.state.timerInterval);
            this.state.timerInterval = null;
        }
    };
    
    // --- 游戏 2, 3, 4 逻辑 (合并) ---
    const game234_shared = {
        config: {
            shapeTypes: ['🍎', '⭐', '🌈', '🎈', '🚀', '🌻', '🎁', '🍦', '🦄', '🍕'],
            maxShapes: 5,
            INITIAL_TIMER_DURATION: 10,
            MIN_TIMER_DURATION: 2,
        },
        state: {
            currentShape1: '', currentShape2: '', count1: 0, count2: 0, sumCount: 0,
            selectedNumbers: [null, null, null], timerInterval: null, timeLeft: 0, centisecondsLeft: 0,
            currentTimerDuration: 10, gamePaused: false,
        },
        handleMoreChallenging: function() {
            if (this.state.currentTimerDuration > this.config.MIN_TIMER_DURATION) {
                this.state.currentTimerDuration--;
            }
            this.cleanupTimer();
            this.startGameCycle();
        },
        displayShapes: function(container, shapeType, count) {
            container.innerHTML = '';
            for (let i = 0; i < count; i++) {
                const shapeElem = document.createElement('div');
                shapeElem.className = 'shape';
                shapeElem.textContent = shapeType;
                container.appendChild(shapeElem);
            }
        },
        generateNumberOptions: function(container, correctNumber, rowIndex) {
            container.innerHTML = '';
            const numbers = [correctNumber];
            const maxPossibleOption = this.config.maxShapes * 2;
            while (numbers.length < 3) {
                let randomNum = getRandomInt(1, Math.min(10, maxPossibleOption));
                if (Math.random() > 0.5) randomNum = getRandomInt(1, maxPossibleOption);
                if (!numbers.includes(randomNum)) numbers.push(randomNum);
            }
            shuffleArray(numbers);
            numbers.forEach(num => {
                const optionElem = document.createElement('div');
                optionElem.className = 'number-option';
                optionElem.textContent = num;
                optionElem.addEventListener('click', () => {
                    if (this.state.gamePaused) return;
                    this.selectNumber(optionElem, num, rowIndex, container);
                });
                container.appendChild(optionElem);
            });
        },
        selectNumber: function(element, number, rowIndex, container) {
            const siblings = container.getElementsByClassName('number-option');
            for (let i = 0; i < siblings.length; i++) siblings[i].classList.remove('selected', 'wrong');
            element.classList.add('selected');
            this.state.selectedNumbers[rowIndex] = number;
            if (this.state.selectedNumbers.every(num => num !== null)) this.checkAnswer();
        },
        checkAnswer: function() {
            if (this.state.gamePaused) return;
            this.cleanupTimer();
            this.state.gamePaused = true;
            const allCorrect = this.state.selectedNumbers[0] === this.state.count1 &&
                               this.state.selectedNumbers[1] === this.state.count2 &&
                               this.state.selectedNumbers[2] === this.state.sumCount;

            this.showResult(allCorrect);
            if(allCorrect) {
                setTimeout(() => {
                    this.elements.resultPopup.classList.remove('show');
                    this.startGameCycle();
                }, 1500);
            } else {
                 if (this.state.selectedNumbers[0] !== this.state.count1) this.markWrongOption(this.elements.options1, this.state.selectedNumbers[0]);
                 if (this.state.selectedNumbers[1] !== this.state.count2) this.markWrongOption(this.elements.options2, this.state.selectedNumbers[1]);
                 if (this.state.selectedNumbers[2] !== this.state.sumCount) this.markWrongOption(this.elements.optionsSum, this.state.selectedNumbers[2]);
                 setTimeout(() => {
                    this.elements.resultPopup.classList.remove('show');
                    this.resetSelectionsForRetry();
                 }, 1500);
            }
        },
        markWrongOption: function(container, selectedValue) {
            const options = container.getElementsByClassName('number-option');
            for(let option of options) {
                if (parseInt(option.textContent) === selectedValue && option.classList.contains('selected')) {
                    option.classList.add('wrong');
                    break;
                }
            }
        },
        resetSelectionsForRetry: function() {
            this.state.gamePaused = false;
            this.state.selectedNumbers = [null, null, null];
            [this.elements.options1, this.elements.options2, this.elements.optionsSum].forEach(container => {
                const allOptions = container.getElementsByClassName('number-option');
                for (let i = 0; i < allOptions.length; i++) {
                    allOptions[i].classList.remove('selected', 'wrong');
                }
            });
            this.startTimer();
        },
        showResult: function(isSuccess, isTimeout = false) {
            this.elements.resultPopup.classList.remove('show');
            if (isTimeout) {
                this.elements.resultEmoji.textContent = '⏱️⌛';
                this.elements.resultText.textContent = '时间到！';
                this.elements.resultText.style.color = '#e74c3c';
            } else if (isSuccess) {
                this.elements.resultEmoji.textContent = '😄🌸';
                this.elements.resultText.textContent = '做得好，Kris！';
                this.elements.resultText.style.color = '#2ecc71';
            } else {
                this.elements.resultEmoji.textContent = '😢🌵';
                this.elements.resultText.textContent = '再试一次！';
                this.elements.resultText.style.color = '#e74c3c';
            }
            requestAnimationFrame(() => this.elements.resultPopup.classList.add('show'));
        },
        startTimer: function() {
            this.state.timeLeft = this.state.currentTimerDuration;
            this.state.centisecondsLeft = 0;
            this.updateTimerDisplay();
            this.cleanupTimer();
            this.state.timerInterval = setInterval(() => {
                this.state.centisecondsLeft -= 10;
                if (this.state.centisecondsLeft < 0) {
                    this.state.centisecondsLeft = 90;
                    this.state.timeLeft--;
                }
                this.updateTimerDisplay();
                if (this.state.timeLeft < 0) {
                    this.cleanupTimer();
                    this.state.gamePaused = true;
                    this.showResult(false, true);
                    setTimeout(() => {
                        this.elements.resultPopup.classList.remove('show');
                        this.startGameCycle();
                    }, 2000);
                }
            }, 100);
        },
        updateTimerDisplay: function() {
            const displaySeconds = String(Math.max(0, this.state.timeLeft)).padStart(2, '0');
            const displayCentiseconds = String(Math.max(0, this.state.centisecondsLeft)).padStart(2, '0');
            this.elements.timerDisplay.textContent = `${displaySeconds}:${displayCentiseconds}`;
        },
        cleanupTimer: function() {
            if (this.state.timerInterval) clearInterval(this.state.timerInterval);
            this.state.timerInterval = null;
        },
        cleanup: function() {
            this.cleanupTimer();
            if(this.elements && this.elements.resultPopup) this.elements.resultPopup.classList.remove('show');
            this.state.gamePaused = false;
        }
    };
    
    const game2 = {
        ...game234_shared, // 继承共享逻辑
        id: 'game2',
        hostElement: document.getElementById('game2-host'),
        elements: {},
        init: function() {
            this.state = {...game234_shared.state}; // 创建新状态
            this.state.currentTimerDuration = this.config.INITIAL_TIMER_DURATION;
            this.elements.shapeGroup1 = this.hostElement.querySelector('#game2-shape-group-1');
            this.elements.shapeGroup2 = this.hostElement.querySelector('#game2-shape-group-2');
            this.elements.icon1 = this.hostElement.querySelector('#game2-icon-1');
            this.elements.icon2 = this.hostElement.querySelector('#game2-icon-2');
            this.elements.options1 = this.hostElement.querySelector('#game2-options-1');
            this.elements.options2 = this.hostElement.querySelector('#game2-options-2');
            this.elements.optionsSum = this.hostElement.querySelector('#game2-options-sum');
            this.elements.resultPopup = this.hostElement.querySelector('#game2-result-popup');
            this.elements.resultEmoji = this.hostElement.querySelector('#game2-result-emoji');
            this.elements.resultText = this.hostElement.querySelector('#game2-result-text');
            this.elements.timerDisplay = this.hostElement.querySelector('#game2-timer');
            const moreChallengingBtn = this.hostElement.querySelector('#game2-more-challenging-btn');
            moreChallengingBtn.onclick = () => this.handleMoreChallenging(); // 使用onclick简化事件监听管理
            this.startGameCycle();
        },
        startGameCycle: function() {
            this.state.gamePaused = false;
            this.state.selectedNumbers = [null, null, null];
            this.elements.shapeGroup1.innerHTML = '';
            this.elements.shapeGroup2.innerHTML = '';

            const shapeIndex1 = getRandomInt(0, this.config.shapeTypes.length - 1);
            let shapeIndex2 = getRandomInt(0, this.config.shapeTypes.length - 1);
            while (shapeIndex2 === shapeIndex1) shapeIndex2 = getRandomInt(0, this.config.shapeTypes.length - 1);
            
            this.state.currentShape1 = this.config.shapeTypes[shapeIndex1];
            this.state.currentShape2 = this.config.shapeTypes[shapeIndex2];
            this.state.count1 = getRandomInt(1, this.config.maxShapes);
            this.state.count2 = getRandomInt(1, this.config.maxShapes);
            this.state.sumCount = this.state.count1 + this.state.count2;
            
            this.displayShapes(this.elements.shapeGroup1, this.state.currentShape1, this.state.count1);
            this.displayShapes(this.elements.shapeGroup2, this.state.currentShape2, this.state.count2);
            
            this.elements.icon1.textContent = this.state.currentShape1;
            this.elements.icon2.textContent = this.state.currentShape2;
            
            this.generateNumberOptions(this.elements.options1, this.state.count1, 0);
            this.generateNumberOptions(this.elements.options2, this.state.count2, 1);
            this.generateNumberOptions(this.elements.optionsSum, this.state.sumCount, 2);
            
            this.startTimer();
        }
    };

    const game3 = {
        ...game234_shared, // 继承共享逻辑
        id: 'game3',
        hostElement: document.getElementById('game3-host'),
        elements: {},
        init: function() {
            this.state = {...game234_shared.state}; // 创建新状态
            this.state.currentTimerDuration = this.config.INITIAL_TIMER_DURATION;
            this.elements.mixedShapesGroup = this.hostElement.querySelector('#game3-mixed-shapes-group');
            this.elements.icon1 = this.hostElement.querySelector('#game3-icon-1');
            this.elements.icon2 = this.hostElement.querySelector('#game3-icon-2');
            this.elements.options1 = this.hostElement.querySelector('#game3-options-1');
            this.elements.options2 = this.hostElement.querySelector('#game3-options-2');
            this.elements.optionsSum = this.hostElement.querySelector('#game3-options-sum');
            this.elements.resultPopup = this.hostElement.querySelector('#game3-result-popup');
            this.elements.resultEmoji = this.hostElement.querySelector('#game3-result-emoji');
            this.elements.resultText = this.hostElement.querySelector('#game3-result-text');
            this.elements.timerDisplay = this.hostElement.querySelector('#game3-timer');
            const moreChallengingBtn = this.hostElement.querySelector('#game3-more-challenging-btn');
            moreChallengingBtn.onclick = () => this.handleMoreChallenging();
            this.startGameCycle();
        },
        startGameCycle: function() {
            this.state.gamePaused = false;
            this.state.selectedNumbers = [null, null, null];
            this.elements.mixedShapesGroup.innerHTML = '';
            
            const shapeIndex1 = getRandomInt(0, this.config.shapeTypes.length - 1);
            let shapeIndex2 = getRandomInt(0, this.config.shapeTypes.length - 1);
            while (shapeIndex2 === shapeIndex1) shapeIndex2 = getRandomInt(0, this.config.shapeTypes.length - 1);
            
            this.state.currentShape1 = this.config.shapeTypes[shapeIndex1];
            this.state.currentShape2 = this.config.shapeTypes[shapeIndex2];
            this.state.count1 = getRandomInt(1, this.config.maxShapes);
            this.state.count2 = getRandomInt(1, this.config.maxShapes);
            this.state.sumCount = this.state.count1 + this.state.count2;
            
            this.displayMixedShapes(this.elements.mixedShapesGroup, this.state.currentShape1, this.state.count1, this.state.currentShape2, this.state.count2);
            
            this.elements.icon1.textContent = this.state.currentShape1;
            this.elements.icon2.textContent = this.state.currentShape2;
            
            this.generateNumberOptions(this.elements.options1, this.state.count1, 0);
            this.generateNumberOptions(this.elements.options2, this.state.count2, 1);
            this.generateNumberOptions(this.elements.optionsSum, this.state.sumCount, 2);
            
            this.startTimer();
        },
        displayMixedShapes: function(container, shape1, num1, shape2, num2) {
            container.innerHTML = '';
            const allShapes = [];
            for (let i = 0; i < num1; i++) allShapes.push(`<div class="shape">${shape1}</div>`);
            for (let i = 0; i < num2; i++) allShapes.push(`<div class="shape">${shape2}</div>`);
            shuffleArray(allShapes);
            container.innerHTML = allShapes.join('');
        }
    };

    const game4 = {
        id: 'game4',
        hostElement: document.getElementById('game4-host'),
        state: { N: 0, M: 0, correctAnswer: 0, currentPins: [], countdownTimerId: null, gameActive: false },
        elements: {},
        init: function() {
            this.elements.pinsArea = this.hostElement.querySelector('#pins-area');
            this.elements.bowlingBall = this.hostElement.querySelector('#bowling-ball');
            this.elements.nValueSpan = this.hostElement.querySelector('#game4-n-value');
            this.elements.mValueSpan = this.hostElement.querySelector('#game4-m-value');
            this.elements.qMarkSpan = this.hostElement.querySelector('#game4-q-mark');
            this.elements.optionsArea = this.hostElement.querySelector('#options-area');
            this.elements.startButton = this.hostElement.querySelector('#start-button');
            this.elements.feedbackArea = this.hostElement.querySelector('#game4-feedback-area');
            this.elements.feedbackIcon = this.hostElement.querySelector('#feedback-icon');
            this.elements.feedbackText = this.hostElement.querySelector('#feedback-text');
            this.elements.countdownDisplay = this.hostElement.querySelector('#game4-countdown-display');

            this.elements.startButton.onclick = () => this.rollBall();
            this.setupRound();
        },
        setupRound: function() {
            this.state.gameActive = false;
            this.elements.startButton.disabled = true;
            this.elements.startButton.style.display = 'block';
            this.elements.optionsArea.innerHTML = '';
            this.elements.mValueSpan.textContent = '';
            this.elements.qMarkSpan.textContent = '?';
            this.elements.feedbackArea.classList.remove('visible');
            this.elements.bowlingBall.style.visibility = 'hidden';
            this.elements.bowlingBall.style.transform = 'translateY(0px)';
            this.state.N = getRandomInt(5, 10);
            this.elements.nValueSpan.textContent = this.state.N;
            this.elements.pinsArea.innerHTML = '';
            this.state.currentPins = [];
            for (let i = 0; i < this.state.N; i++) {
                const pin = document.createElement('div');
                pin.className = 'pin';
                this.elements.pinsArea.appendChild(pin);
                this.state.currentPins.push(pin);
            }
            this.startCountdown();
        },
        startCountdown: function() {
            let count = 3;
            this.elements.countdownDisplay.textContent = count;
            this.elements.countdownDisplay.style.display = 'block';
            if (this.state.countdownTimerId) clearInterval(this.state.countdownTimerId);
            this.state.countdownTimerId = setInterval(() => {
                count--;
                if (count > 0) {
                    this.elements.countdownDisplay.textContent = count;
                } else {
                    clearInterval(this.state.countdownTimerId);
                    this.state.countdownTimerId = null;
                    this.elements.countdownDisplay.style.display = 'none';
                    this.elements.startButton.disabled = false;
                }
            }, 1000);
        },
        rollBall: function() {
            if (this.state.gameActive) return;
            this.state.gameActive = true;
            this.elements.startButton.style.display = 'none';
            this.elements.bowlingBall.style.visibility = 'visible';
            const pinsAreaRect = this.elements.pinsArea.getBoundingClientRect();
            const ballRect = this.elements.bowlingBall.getBoundingClientRect();
            const travelDistance = ballRect.top - (pinsAreaRect.top + pinsAreaRect.height / 2);
            this.elements.bowlingBall.style.transform = `translateY(-${travelDistance + 30}px)`;
            setTimeout(() => this.knockPins(), 800);
        },
        knockPins: function() {
            this.state.M = getRandomInt(1, this.state.N);
            this.elements.mValueSpan.textContent = this.state.M;
            this.state.currentPins.forEach(pin => pin.classList.remove('hit'));
            let hitIndices = [];
            while(hitIndices.length < this.state.M) {
                let randomIndex = getRandomInt(0, this.state.N - 1);
                if (!hitIndices.includes(randomIndex)) hitIndices.push(randomIndex);
            }
            hitIndices.forEach(index => this.state.currentPins[index].classList.add('hit'));
            this.state.correctAnswer = this.state.N - this.state.M;
            this.displayOptions();
            this.state.gameActive = false;
        },
        displayOptions: function() {
            this.elements.optionsArea.innerHTML = '';
            let options = [this.state.correctAnswer];
            while (options.length < 3) {
                let distractor = getRandomInt(0, this.state.N);
                if (!options.includes(distractor)) options.push(distractor);
            }
            shuffleArray(options);
            options.forEach(opt => {
                const button = document.createElement('button');
                button.className = 'option-button';
                button.textContent = opt;
                button.onclick = () => {
                    if (this.state.gameActive) return;
                    this.checkAnswer(opt);
                };
                this.elements.optionsArea.appendChild(button);
            });
        },
        checkAnswer: function(selectedAnswer) {
            this.state.gameActive = true;
            if (selectedAnswer === this.state.correctAnswer) {
                this.elements.feedbackIcon.textContent = '😊🌸';
                this.elements.feedbackText.textContent = '太棒了!';
                this.elements.feedbackArea.classList.add('visible');
                setTimeout(() => {
                    this.elements.feedbackArea.classList.remove('visible');
                    this.setupRound();
                }, 1500);
            } else {
                this.elements.feedbackIcon.textContent = '😢🌵';
                this.elements.feedbackText.textContent = '再试一次!';
                this.elements.feedbackArea.classList.add('visible');
                setTimeout(() => {
                    this.elements.feedbackArea.classList.remove('visible');
                    this.state.gameActive = false;
                }, 2000);
            }
        },
        cleanup: function() {
            if (this.state.countdownTimerId) clearInterval(this.state.countdownTimerId);
            this.state.countdownTimerId = null;
            if (this.elements.feedbackArea) this.elements.feedbackArea.classList.remove('visible');
            if (this.elements.countdownDisplay) this.elements.countdownDisplay.style.display = 'none';
            if (this.elements.startButton) this.elements.startButton.disabled = true;
            this.state.gameActive = false;
        }
    };

    // --- 游戏 5 (水果金钱) 逻辑 ---
    const game5 = {
        id: 'game5',
        hostElement: document.getElementById('game5-host'),
        state: { playerMoney: 0, item1: {}, item2: {}, correctAnswer: "", score: 0, tries: 50, gamePaused: false },
        elements: {},
        fruitData: [ {name:"苹果",icon:"🍎"}, {name:"香蕉",icon:"🍌"}, {name:"橘子",icon:"🍊"}, {name:"葡萄",icon:"🍇"}, {name:"梨",icon:"🍐"} ],
        init: function() {
            this.elements.playerMoneyDisplay = this.hostElement.querySelector('#game5-player-money');
            this.elements.item1Icon = this.hostElement.querySelector('#game5-fruit1-icon');
            this.elements.item1Name = this.hostElement.querySelector('#game5-fruit1-name');
            this.elements.item1Price = this.hostElement.querySelector('#game5-fruit1-price');
            this.elements.item2Icon = this.hostElement.querySelector('#game5-fruit2-icon');
            this.elements.item2Name = this.hostElement.querySelector('#game5-fruit2-name');
            this.elements.item2Price = this.hostElement.querySelector('#game5-fruit2-price');
            this.elements.questionDisplay = this.hostElement.querySelector('#game5-purchase-question');
            this.elements.choiceOptions = this.hostElement.querySelector('#game5-choice-options');
            this.elements.resultPopup = this.hostElement.querySelector('#game5-result-popup');
            this.elements.resultEmoji = this.hostElement.querySelector('#game5-result-emoji');
            this.elements.resultText = this.hostElement.querySelector('#game5-result-text');
            this.elements.scoreDisplay = this.hostElement.querySelector('#game5-score-display');
            this.elements.triesDisplay = this.hostElement.querySelector('#game5-tries-display');
            this.state.score = 0;
            this.state.tries = 50;
            this.updateScoreDisplay();
            this.startGameCycle();
        },
        updateScoreDisplay: function() {
            this.elements.scoreDisplay.textContent = `得分: ${this.state.score}`;
            this.elements.triesDisplay.textContent = `尝试次数: ${this.state.tries}`;
        },
        startGameCycle: function() {
            if (this.state.tries <= 0) {
                this.elements.questionDisplay.textContent = "游戏结束!";
                return;
            }
            this.state.gamePaused = false;
            this.state.playerMoney = getRandomInt(5, 12);

            let fruit1Idx = getRandomInt(0, this.fruitData.length - 1);
            let fruit2Idx;
            do { fruit2Idx = getRandomInt(0, this.fruitData.length - 1); } while (fruit2Idx === fruit1Idx);

            this.state.item1 = {...this.fruitData[fruit1Idx], price: getRandomInt(2, 6)};
            this.state.item2 = {...this.fruitData[fruit2Idx], price: getRandomInt(2, 6)};
            if (this.state.item1.price === this.state.item2.price) this.state.item2.price +=1;
            
            this.elements.playerMoneyDisplay.textContent = `你有 💰${this.state.playerMoney}个金币。`;
            this.elements.item1Icon.textContent = this.state.item1.icon;
            this.elements.item1Name.textContent = this.state.item1.name;
            this.elements.item1Price.textContent = `${this.state.item1.price} 金币`;
            this.elements.item2Icon.textContent = this.state.item2.icon;
            this.elements.item2Name.textContent = this.state.item2.name;
            this.elements.item2Price.textContent = `${this.state.item2.price} 金币`;

            this.generatePurchaseScenario();
        },
        generatePurchaseScenario: function() {
            const canBuy1 = this.state.playerMoney >= this.state.item1.price;
            const canBuy2 = this.state.playerMoney >= this.state.item2.price;
            const canBuyBoth = this.state.playerMoney >= (this.state.item1.price + this.state.item2.price);
            let options = [];
            
            this.elements.questionDisplay.textContent = "你能买得起什么？";
            if (canBuyBoth) {
                this.state.correctAnswer = "两个都要";
                options = ["两个都要", this.state.item1.name, this.state.item2.name, "什么也买不了"];
            } else if (canBuy1 && canBuy2) {
                this.state.correctAnswer = `${this.state.item1.name} 或 ${this.state.item2.name}`;
                options = [this.state.item1.name, this.state.item2.name, "两个都要", "什么也买不了"];
            } else if (canBuy1) {
                this.state.correctAnswer = this.state.item1.name;
                options = [this.state.item1.name, this.state.item2.name, "两个都要", "什么也买不了"];
            } else if (canBuy2) {
                this.state.correctAnswer = this.state.item2.name;
                options = [this.state.item1.name, this.state.item2.name, "两个都要", "什么也买不了"];
            } else {
                this.state.correctAnswer = "什么也买不了";
                options = ["什么也买不了", this.state.item1.name, this.state.item2.name, "两个都要"];
            }
            this.displayChoiceOptions(options);
        },
        displayChoiceOptions: function(optionsArray) {
            this.elements.choiceOptions.innerHTML = '';
            shuffleArray(optionsArray);
            optionsArray.forEach(optText => {
                const button = document.createElement('div');
                button.className = 'choice-option';
                button.textContent = optText;
                button.onclick = () => this.checkAnswer(optText);
                this.elements.choiceOptions.appendChild(button);
            });
        },
        checkAnswer: function(selectedChoice) {
            if (this.state.gamePaused) return;
            this.state.gamePaused = true;
            this.state.tries--;
            
            let isCorrect = false;
            if (String(this.state.correctAnswer).includes("或")) {
                 isCorrect = selectedChoice === this.state.item1.name || selectedChoice === this.state.item2.name;
            } else {
                isCorrect = selectedChoice === this.state.correctAnswer;
            }
            
            if (isCorrect) this.state.score++;
            this.updateScoreDisplay();
            this.showResultPopup(isCorrect);
            
            setTimeout(() => {
                this.elements.resultPopup.classList.remove('show');
                this.startGameCycle();
            }, 1500);
        },
        showResultPopup: function(isSuccess) {
            this.elements.resultPopup.classList.remove('show');
            requestAnimationFrame(() => {
                if (isSuccess) {
                    this.elements.resultEmoji.textContent = '🎉✨';
                    this.elements.resultText.textContent = '太棒了！';
                    this.elements.resultText.style.color = '#27ae60';
                } else {
                    this.elements.resultEmoji.textContent = '😢🌵';
                    this.elements.resultText.textContent = '再试一次！';
                    this.elements.resultText.style.color = '#e74c3c';
                }
                this.elements.resultPopup.classList.add('show');
            });
        },
        cleanup: function() {
            this.state.gamePaused = false;
            if (this.elements.resultPopup) this.elements.resultPopup.classList.remove('show');
        }
    };
    
    // --- 游戏 6 (外星人跳跃) 逻辑 ---
    const game6 = {
        id: 'game6',
        hostElement: document.getElementById('game6-host'),
        state: { currentPosition: 0, targetPosition: 0, correctJumps: 0, score: 0 },
        elements: {},
        config: { maxNumberPathValue: 15 },
        init: function() {
            this.elements.currentPosDisplay = this.hostElement.querySelector('#game6-current-pos');
            this.elements.targetPosDisplay = this.hostElement.querySelector('#game6-target-pos');
            this.elements.jumpOptionsContainer = this.hostElement.querySelector('#game6-jump-options');
            this.elements.numberPathContainer = this.hostElement.querySelector('#game6-number-path');
            this.elements.resultPopup = this.hostElement.querySelector('#game6-result-popup');
            this.elements.resultEmojiDisplay = this.hostElement.querySelector('#game6-result-emoji');
            this.elements.resultTextDisplay = this.hostElement.querySelector('#game6-result-text');
            this.elements.nextButton = this.hostElement.querySelector('#game6-next-button');
            this.elements.scoreBoardDisplay = this.hostElement.querySelector('#game6-score-board');
            this.elements.nextButton.onclick = () => {
                this.elements.resultPopup.classList.remove('show');
                setTimeout(() => this.setupNewProblem(), 300); 
            };
            this.state.score = 0;
            this.updateScoreBoard();
            this.setupNewProblem();
        },
        updateScoreBoard: function() { this.elements.scoreBoardDisplay.textContent = `得分: ${this.state.score}`; },
        renderNumberPath: function() {
            this.elements.numberPathContainer.innerHTML = '';
            const displayMin = Math.max(0, this.state.targetPosition - 2);
            const displayMax = Math.min(this.config.maxNumberPathValue, this.state.currentPosition + 2);
            for (let i = displayMin; i <= displayMax; i++) {
                const segment = document.createElement('span');
                segment.className = 'path-segment';
                segment.textContent = i;
                if (i === this.state.currentPosition) segment.classList.add('current');
                if (i === this.state.targetPosition) segment.classList.add('target');
                this.elements.numberPathContainer.appendChild(segment);
            }
        },
        setupNewProblem: function() {
            this.state.correctJumps = getRandomInt(2, 8);
            this.state.targetPosition = getRandomInt(0, this.config.maxNumberPathValue - this.state.correctJumps); 
            this.state.currentPosition = this.state.targetPosition + this.state.correctJumps;
            this.elements.currentPosDisplay.textContent = `外星人位置: ${this.state.currentPosition}`;
            this.elements.targetPosDisplay.textContent = `目标星球: ${this.state.targetPosition}`;
            this.renderNumberPath();
            this.displayJumpOptions();
        },
        displayJumpOptions: function() {
            this.elements.jumpOptionsContainer.innerHTML = '';
            let options = [this.state.correctJumps];
            while (options.length < 4) {
                let distractor = getRandomInt(1, Math.max(5, this.state.correctJumps + 2));
                if (!options.includes(distractor)) options.push(distractor);
            }
            shuffleArray(options);
            options.forEach(numJumps => {
                const button = document.createElement('button');
                button.className = 'jump-option';
                button.textContent = `${numJumps}`;
                button.onclick = () => this.handleAnswer(numJumps);
                this.elements.jumpOptionsContainer.appendChild(button);
            });
        },
        handleAnswer: function(selectedJumps) {
            if (selectedJumps === this.state.correctJumps) {
                this.elements.resultEmojiDisplay.textContent = '🌟🛰️';
                this.elements.resultTextDisplay.textContent = '完美着陆！';
                this.elements.resultTextDisplay.style.color = '#00ff99';
                this.state.score++;
            } else {
                this.elements.resultEmojiDisplay.textContent = '😵💫';
                this.elements.resultTextDisplay.textContent = `不对哦！正确答案是 ${this.state.correctJumps} 步。`;
                this.elements.resultTextDisplay.style.color = '#ff7043';
            }
            this.updateScoreBoard();
            this.elements.resultPopup.classList.add('show');
        },
        cleanup: function() {
            if (this.elements.resultPopup) this.elements.resultPopup.classList.remove('show');
        }
    };
    
    // --- 游戏 7 (超级英雄数学) 逻辑 ---
    const game7 = {
        id: 'game7',
        hostElement: document.getElementById('game7-host'),
        state: { score: 0, level: 1, lives: 3, correctAnswers: 0, streak: 0, currentQuestion: {} },
        elements: {},
        init: function() {
            this.elements.levelDisplay = this.hostElement.querySelector('#game7-level-display');
            this.elements.scoreDisplay = this.hostElement.querySelector('#game7-score-display');
            this.elements.livesDisplay = this.hostElement.querySelector('#game7-lives-display');
            this.elements.mathQuestionEl = this.hostElement.querySelector('#game7-math-question');
            this.elements.answerInput = this.hostElement.querySelector('#game7-answer-input');
            this.elements.submitAnswerBtn = this.hostElement.querySelector('#game7-submit-answer');
            this.elements.supermanProgress = this.hostElement.querySelector('#game7-superman-progress');
            this.elements.bumblebeeProgress = this.hostElement.querySelector('#game7-bumblebee-progress');
            this.elements.ironmanProgress = this.hostElement.querySelector('#game7-ironman-progress');
            this.elements.supermanStatus = this.hostElement.querySelector('#game7-superman-status');
            this.elements.bumblebeeStatus = this.hostElement.querySelector('#game7-bumblebee-status');
            this.elements.ironmanStatus = this.hostElement.querySelector('#game7-ironman-status');
            this.elements.correctFeedback = this.hostElement.querySelector('#game7-correct-feedback');
            this.elements.wrongFeedback = this.hostElement.querySelector('#game7-wrong-feedback');
            this.elements.gameOverScreen = this.hostElement.querySelector('#game7-game-over-screen');
            this.elements.correctAnswerDisplay = this.hostElement.querySelector('#game7-correct-answer-display');
            this.elements.finalScore = this.hostElement.querySelector('#game7-final-score');
            this.elements.nextQuestionBtn = this.hostElement.querySelector('#game7-next-question');
            this.elements.tryAgainBtn = this.hostElement.querySelector('#game7-try-again');
            this.elements.playAgainBtn = this.hostElement.querySelector('#game7-play-again');

            this.elements.submitAnswerBtn.onclick = () => this.checkAnswer();
            this.elements.answerInput.onkeypress = (e) => { if (e.key === 'Enter') this.checkAnswer(); };
            this.elements.nextQuestionBtn.onclick = () => this.hideFeedback(true);
            this.elements.tryAgainBtn.onclick = () => this.hideFeedback(false);
            this.elements.playAgainBtn.onclick = () => { this.elements.gameOverScreen.classList.remove('show'); this.startGame(); };

            this.startGame();
        },
        startGame: function() {
            this.state = { score: 0, level: 1, lives: 3, correctAnswers: 0, streak: 0, currentQuestion: {} };
            this.updateGameStats();
            this.updateCharacterProgress();
            this.generateQuestion();
        },
        generateQuestion: function() {
            const operation = Math.random() < 0.5 ? '+' : '-';
            let num1, num2, answer;
            if (operation === '+') {
                num1 = getRandomInt(1, 9);
                num2 = getRandomInt(1, 10 - num1);
                answer = num1 + num2;
            } else {
                num1 = getRandomInt(1, 10);
                num2 = getRandomInt(1, num1);
                answer = num1 - num2;
            }
            this.state.currentQuestion = { num1, num2, operation, answer };
            this.elements.mathQuestionEl.textContent = `${num1} ${operation} ${num2} = ?`;
            this.elements.answerInput.value = '';
            this.elements.answerInput.focus();
        },
        checkAnswer: function() {
            const userAnswer = parseInt(this.elements.answerInput.value, 10);
            if (isNaN(userAnswer)) return;
            
            if (userAnswer === this.state.currentQuestion.answer) {
                this.state.score += 20;
                this.state.correctAnswers++;
                this.state.streak++;
                if (this.state.streak > 0 && this.state.streak % 5 === 0 && this.state.lives < 5) this.state.lives++;
                if (this.state.correctAnswers > 0 && this.state.correctAnswers % 3 === 0) this.state.level++;
                this.elements.correctFeedback.classList.add('show');
            } else {
                this.state.lives--;
                this.state.streak = 0;
                this.elements.correctAnswerDisplay.textContent = this.state.currentQuestion.answer;
                this.elements.wrongFeedback.classList.add('show');
            }
            this.updateGameStats();
            this.updateCharacterProgress();
            if (this.state.lives <= 0) setTimeout(() => this.showGameOver(), 1000);
        },
        updateGameStats: function() {
            this.elements.scoreDisplay.textContent = this.state.score;
            this.elements.levelDisplay.textContent = this.state.level;
            this.elements.livesDisplay.textContent = this.state.lives;
        },
        updateCharacterProgress: function() {
            const update = (progressEl, statusEl, requiredScore, unlockText, requirementText) => {
                const percent = Math.min(100, (this.state.score / requiredScore) * 100);
                progressEl.style.width = `${percent}%`;
                if(this.state.score >= requiredScore) {
                     statusEl.textContent = unlockText;
                     statusEl.style.color = 'green';
                } else {
                    statusEl.textContent = requirementText;
                    statusEl.style.color = '#555';
                }
            };
            update(this.elements.supermanProgress, this.elements.supermanStatus, 100, '已解锁!', '得分100解锁');
            update(this.elements.bumblebeeProgress, this.elements.bumblebeeStatus, 200, '已解锁!', '得分200解锁');
            update(this.elements.ironmanProgress, this.elements.ironmanStatus, 400, '已解锁!', '得分400解锁');
        },
        hideFeedback: function(isCorrect) {
            const modal = isCorrect ? this.elements.correctFeedback : this.elements.wrongFeedback;
            modal.classList.remove('show');
            if (this.state.lives > 0) this.generateQuestion();
        },
        showGameOver: function() {
            this.elements.finalScore.textContent = this.state.score;
            this.elements.gameOverScreen.classList.add('show');
        },
        cleanup: function() {
            this.elements.correctFeedback.classList.remove('show');
            this.elements.wrongFeedback.classList.remove('show');
            this.elements.gameOverScreen.classList.remove('show');
        }
    };
    
    // --- 游戏 8 (儿童算术) 逻辑 ---
    const game8 = {
        id: 'game8',
        hostElement: document.getElementById('game8-host'),
        state: { score: 0, currentAnswer: null, operations: ['addition', 'subtraction', 'multiplication'] },
        elements: {},
        init: function() {
            this.elements.problemElement = this.hostElement.querySelector('#game8-problem');
            this.elements.optionsElement = this.hostElement.querySelector('#game8-options');
            this.elements.messageElement = this.hostElement.querySelector('#game8-message');
            this.elements.scoreElement = this.hostElement.querySelector('#game8-score');
            this.elements.starsElement = this.hostElement.querySelector('#game8-stars');
            this.elements.nextButton = this.hostElement.querySelector('#game8-next-btn');
            this.elements.celebrationElement = this.hostElement.querySelector('#game8-celebration');
            this.elements.addCheck = this.hostElement.querySelector('#game8-addition');
            this.elements.subCheck = this.hostElement.querySelector('#game8-subtraction');
            this.elements.mulCheck = this.hostElement.querySelector('#game8-multiplication');

            this.elements.nextButton.onclick = () => this.updateProblem();
            [this.elements.addCheck, this.elements.subCheck, this.elements.mulCheck].forEach(el => {
                el.onchange = () => this.checkOperations();
            });

            this.state.score = 0;
            this.elements.scoreElement.textContent = '0';
            this.elements.starsElement.textContent = '';
            this.checkOperations();
        },
        checkOperations: function() {
            this.state.operations = [];
            if (this.elements.addCheck.checked) this.state.operations.push('addition');
            if (this.elements.subCheck.checked) this.state.operations.push('subtraction');
            if (this.elements.mulCheck.checked) this.state.operations.push('multiplication');
            if (this.state.operations.length === 0) {
                this.elements.addCheck.checked = true;
                this.state.operations.push('addition');
            }
            this.updateProblem();
        },
        updateProblem: function() {
            this.elements.messageElement.textContent = '';
            this.elements.messageElement.className = 'message';
            const opType = this.state.operations[getRandomInt(0, this.state.operations.length - 1)];
            let num1, num2, answer, operator;
            switch (opType) {
                case 'addition':
                    num1 = getRandomInt(0, 10); num2 = getRandomInt(0, 10);
                    answer = num1 + num2; operator = '+'; break;
                case 'subtraction':
                    num2 = getRandomInt(0, 10); num1 = num2 + getRandomInt(0, 10);
                    answer = num1 - num2; operator = '-'; break;
                case 'multiplication':
                    num1 = getRandomInt(0, 10); num2 = getRandomInt(0, 10);
                    answer = num1 * num2; operator = '×'; break;
            }
            this.elements.problemElement.textContent = `${num1} ${operator} ${num2} = ?`;
            this.state.currentAnswer = answer;
            this.generateOptions(answer);
        },
        generateOptions: function(correctAnswer) {
            this.elements.optionsElement.innerHTML = '';
            const options = [correctAnswer];
            while (options.length < 4) {
                let wrongAnswer = correctAnswer + getRandomInt(-3, 3);
                if (wrongAnswer >= 0 && !options.includes(wrongAnswer)) options.push(wrongAnswer);
            }
            shuffleArray(options);
            options.forEach(option => {
                const button = document.createElement('button');
                button.className = 'option';
                button.textContent = option;
                button.onclick = () => this.checkAnswer(option);
                this.elements.optionsElement.appendChild(button);
            });
        },
        checkAnswer: function(selectedAnswer) {
            this.hostElement.querySelectorAll('.option').forEach(btn => btn.disabled = true);
            if (selectedAnswer === this.state.currentAnswer) {
                this.elements.messageElement.textContent = '答对了！';
                this.elements.messageElement.className = 'message correct';
                this.state.score++;
                this.elements.scoreElement.textContent = this.state.score;
                this.updateStars();
                this.celebrate();
                setTimeout(() => this.updateProblem(), 1500);
            } else {
                this.elements.messageElement.textContent = '答错了，再试一次！';
                this.elements.messageElement.className = 'message wrong';
            }
             this.hostElement.querySelectorAll('.option').forEach(button => {
                if (parseInt(button.textContent) === this.state.currentAnswer) button.style.backgroundColor = '#40c057';
                if (parseInt(button.textContent) === selectedAnswer && selectedAnswer !== this.state.currentAnswer) button.style.backgroundColor = '#fa5252';
            });
        },
        updateStars: function() { this.elements.starsElement.textContent = '★'.repeat(Math.min(5, Math.floor(this.state.score / 5))); },
        celebrate: function() { game1.celebrate.call(this); }, // 复用游戏1的庆祝逻辑
        cleanup: function() {}
    };

    // --- 游戏 9 (20以内加减) 逻辑 ---
    const game9 = {
        id: 'game9',
        hostElement: document.getElementById('game9-host'),
        state: { score: 0, timerDuration: 10, timerInterval: null, timeLeft: 0, gameActive: false, currentProblem: {} },
        elements: {},
        init: function() {
            this.elements.timerValueDisplay = this.hostElement.querySelector('#game9-timer-value');
            this.elements.decreaseTimerBtn = this.hostElement.querySelector('#game9-decrease-timer');
            this.elements.increaseTimerBtn = this.hostElement.querySelector('#game9-increase-timer');
            this.elements.problemDisplay = this.hostElement.querySelector('#game9-problem-display');
            this.elements.answerButtons = [ this.hostElement.querySelector('#game9-ans1'), this.hostElement.querySelector('#game9-ans2'), this.hostElement.querySelector('#game9-ans3') ];
            this.elements.timeLeftDisplay = this.hostElement.querySelector('#game9-time-left');
            this.elements.scoreDisplay = this.hostElement.querySelector('#game9-score');
            this.elements.feedbackMessage = this.hostElement.querySelector('#game9-feedback-message');
            this.elements.startGameBtn = this.hostElement.querySelector('#game9-start-game');
            this.elements.nextQuestionBtn = this.hostElement.querySelector('#game9-next-question');
            
            this.state.score = 0;
            this.state.gameActive = false;
            this.updateScoreDisplay();
            this.updateTimerValueDisplay();
            this.disableAnswerButtons();
            this.elements.nextQuestionBtn.style.display = 'none';
            this.elements.startGameBtn.style.display = 'block';
            this.enableTimerAdjustmentButtons(true);
            this.elements.problemDisplay.textContent = '点击“开始游戏”';
            this.elements.timeLeftDisplay.textContent = 'N/A';
            this.elements.answerButtons.forEach(b => b.textContent = '');

            this.elements.startGameBtn.onclick = () => this.startGame();
            this.elements.decreaseTimerBtn.onclick = () => this.adjustTimer(-5);
            this.elements.increaseTimerBtn.onclick = () => this.adjustTimer(5);
            this.elements.nextQuestionBtn.onclick = () => this.nextQuestion();
            this.elements.answerButtons.forEach(button => button.onclick = () => this.checkAnswer(button));
        },
        adjustTimer: function(amount) {
            if (this.state.gameActive) return;
            this.state.timerDuration = Math.max(5, Math.min(60, this.state.timerDuration + amount));
            this.updateTimerValueDisplay();
        },
        updateTimerValueDisplay: function() { this.elements.timerValueDisplay.textContent = this.state.timerDuration; },
        startGame: function() {
            this.state.score = 0;
            this.state.gameActive = true;
            this.updateScoreDisplay();
            this.elements.feedbackMessage.textContent = '';
            this.elements.startGameBtn.style.display = 'none';
            this.enableTimerAdjustmentButtons(false);
            this.nextQuestion();
        },
        nextQuestion: function() {
            this.clearFeedback();
            this.enableAnswerButtons();
            this.elements.nextQuestionBtn.style.display = 'none';
            
            const isAddition = Math.random() < 0.5;
            let num1, num2, correctAnswer;
            if (isAddition) {
                num1 = getRandomInt(0, 10);
                num2 = getRandomInt(0, 20 - num1);
                correctAnswer = num1 + num2;
                this.state.currentProblem = { num1, num2, operator: '+', correctAnswer };
            } else {
                num1 = getRandomInt(0, 20);
                num2 = getRandomInt(0, num1);
                correctAnswer = num1 - num2;
                this.state.currentProblem = { num1, num2, operator: '-', correctAnswer };
            }
            this.elements.problemDisplay.textContent = `${num1} ${this.state.currentProblem.operator} ${num2} = ?`;
            
            let options = [correctAnswer];
            while (options.length < 3) {
                let distractor = getRandomInt(Math.max(0, correctAnswer - 5), Math.min(20, correctAnswer + 5));
                if (!options.includes(distractor)) options.push(distractor);
            }
            shuffleArray(options);
            this.elements.answerButtons.forEach((button, index) => button.textContent = options[index]);
            
            this.startTimer();
        },
        startTimer: function() {
            this.state.timeLeft = this.state.timerDuration;
            this.elements.timeLeftDisplay.textContent = this.state.timeLeft;
            this.cleanup();
            this.state.timerInterval = setInterval(() => {
                this.state.timeLeft--;
                this.elements.timeLeftDisplay.textContent = this.state.timeLeft;
                if (this.state.timeLeft <= 0) {
                    this.cleanup();
                    this.showFeedback(`时间到！答案是 ${this.state.currentProblem.correctAnswer}`, 'incorrect');
                    this.disableAnswerButtons();
                    this.elements.nextQuestionBtn.style.display = 'block';
                    this.elements.startGameBtn.style.display = 'block';
                    this.enableTimerAdjustmentButtons(true);
                }
            }, 1000);
        },
        checkAnswer: function(button) {
            if (!this.state.gameActive || this.state.timeLeft <= 0) return;
            this.cleanup();
            this.disableAnswerButtons();
            const selectedAnswer = parseInt(button.textContent);
            if (selectedAnswer === this.state.currentProblem.correctAnswer) {
                this.state.score++;
                this.updateScoreDisplay();
                this.showFeedback("正确!", 'correct');
            } else {
                this.showFeedback(`错误！答案是 ${this.state.currentProblem.correctAnswer}`, 'incorrect');
            }
            this.elements.nextQuestionBtn.style.display = 'block';
        },
        showFeedback: function(message, typeClass) {
            this.elements.feedbackMessage.textContent = message;
            this.elements.feedbackMessage.className = 'message-area ' + typeClass;
        },
        clearFeedback: function() {
            this.elements.feedbackMessage.textContent = '';
            this.elements.feedbackMessage.className = 'message-area';
        },
        disableAnswerButtons: function() { this.elements.answerButtons.forEach(button => button.disabled = true); },
        enableAnswerButtons: function() { this.elements.answerButtons.forEach(button => button.disabled = false); },
        enableTimerAdjustmentButtons: function(enable) {
            this.elements.decreaseTimerBtn.disabled = !enable;
            this.elements.increaseTimerBtn.disabled = !enable;
        },
        updateScoreDisplay: function() { this.elements.scoreDisplay.textContent = this.state.score; },
        cleanup: function() { if (this.state.timerInterval) clearInterval(this.state.timerInterval); this.state.timerInterval = null; }
    };
    
    // --- 游戏 10 (视觉数学) 逻辑 ---
    const game10 = {
        ...game9, // 继承自游戏9
        id: 'game10',
        hostElement: document.getElementById('game10-host'),
        state: { ...game9.state, currentTheme: 'matchsticks' }, // 继承并添加主题
        elements: {},
        visuals: {
            matchstickSVGs: { 1: '<svg width="12" height="40" viewbox="0 0 12 40"><rect x="4" y="0" width="4" height="40" fill="#DEB887" stroke="#A0522D" stroke-width="0.5"/></svg>' },
            chickEmoji: '🐥',
        },
        init: function() {
            // 继承游戏9的元素和设置
            game9.init.call(this); 
            // 游戏10的特定元素
            this.elements.themeMatchsticksBtn = this.hostElement.querySelector('#game10-theme-matchsticks');
            this.elements.themeChicksBtn = this.hostElement.querySelector('#game10-theme-chicks');

            this.state.score = 0;
            this.state.currentTheme = 'matchsticks';
            this.updateThemeButtons();
            this.elements.themeMatchsticksBtn.onclick = () => this.setTheme('matchsticks');
            this.elements.themeChicksBtn.onclick = () => this.setTheme('chicks');
            this.elements.problemDisplay.innerHTML = '选择一个主题然后开始游戏！';
        },
        setTheme: function(themeName) {
            this.state.currentTheme = themeName;
            this.updateThemeButtons();
            if (this.state.gameActive) this.elements.problemDisplay.innerHTML = this.formatProblem();
        },
        updateThemeButtons: function() {
            this.elements.themeMatchsticksBtn.classList.toggle('active-theme', this.state.currentTheme === 'matchsticks');
            this.elements.themeChicksBtn.classList.toggle('active-theme', this.state.currentTheme === 'chicks');
        },
        getVisualForNumber: function(number) {
            if (number > 7) return number.toString();
            if (this.state.currentTheme === 'matchsticks') {
                 return (this.visuals.matchstickSVGs[1] || '|').repeat(number);
            } else {
                 return this.visuals.chickEmoji.repeat(number);
            }
        },
        formatProblem: function() {
            const { num1, operator, num2 } = this.state.currentProblem;
            const visual1 = this.getVisualForNumber(num1);
            const visual2 = this.getVisualForNumber(num2);
            return `${visual1} <span style="font-weight:bold; color:#FF6B6B;">${operator}</span> ${visual2} = ?`;
        },
        nextQuestion: function() {
            this.clearFeedback();
            this.enableAnswerButtons();
            this.elements.nextQuestionBtn.style.display = 'none';
            
            const isAddition = Math.random() < 0.5;
            let num1, num2, correctAnswer;
            if (isAddition) {
                num1 = getRandomInt(1, 7);
                num2 = getRandomInt(1, Math.min(7, 12 - num1));
                correctAnswer = num1 + num2;
                this.state.currentProblem = { num1, num2, operator: '+', correctAnswer };
            } else {
                num1 = getRandomInt(2, 12);
                num2 = getRandomInt(1, Math.min(7, num1 - 1));
                correctAnswer = num1 - num2;
                this.state.currentProblem = { num1, num2, operator: '-', correctAnswer };
            }
            this.elements.problemDisplay.innerHTML = this.formatProblem();

            let options = [correctAnswer];
            while (options.length < 3) {
                let distractor = getRandomInt(Math.max(0, correctAnswer - 4), Math.min(20, correctAnswer + 4));
                if (!options.includes(distractor)) options.push(distractor);
            }
            shuffleArray(options);
            this.elements.answerButtons.forEach((button, index) => button.textContent = options[index]);
            
            this.startTimer();
        }
    };
    
    // 初始化主应用控制器
    app.init();
});
</script>
</body>
</html>
