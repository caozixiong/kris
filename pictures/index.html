<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é€’å½’å›¾ç‰‡ç”»å»Š</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        h1 {
            text-align: center;
            color: #333;
        }
        .breadcrumb {
            padding: 10px;
            background-color: #fff;
            border-radius: 5px;
            margin-bottom: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .breadcrumb a {
            color: #0366d6;
            text-decoration: none;
        }
        .breadcrumb a:hover {
            text-decoration: underline;
        }
        .folder-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            grid-gap: 15px;
            margin-bottom: 20px;
        }
        .folder-item {
            background-color: #f0f8ff;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }
        .folder-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        .folder-icon {
            font-size: 40px;
            color: #0366d6;
        }
        .folder-name {
            margin-top: 10px;
            font-weight: bold;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        .gallery {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            grid-gap: 20px;
        }
        .gallery-item {
            overflow: hidden;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            background-color: white;
            transition: transform 0.3s ease;
        }
        .gallery-item:hover {
            transform: translateY(-5px);
        }
        .gallery-item img {
            width: 100%;
            height: 200px;
            object-fit: cover;
            display: block;
        }
        .image-info {
            padding: 10px;
        }
        .image-name {
            margin: 0;
            font-size: 16px;
            color: #333;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        .path-info {
            margin: 5px 0 0 0;
            font-size: 12px;
            color: #666;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        .loading {
            text-align: center;
            padding: 20px;
            font-size: 18px;
            color: #666;
        }
        .back-to-top {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: #0366d6;
            color: white;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            font-size: 24px;
            cursor: pointer;
            display: none;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }
        .back-to-top:hover {
            background-color: #0353b4;
        }
    </style>
</head>
<body>
    <h1>é€’å½’å›¾ç‰‡ç”»å»Š</h1>
    <div id="breadcrumb" class="breadcrumb">
        <a href="#" data-path="">é¦–é¡µ</a>
    </div>
    <div id="folders" class="folder-grid"></div>
    <div id="gallery" class="gallery">
        <div class="loading">æ­£åœ¨åŠ è½½å†…å®¹...</div>
    </div>
    <button id="backToTop" class="back-to-top" title="è¿”å›é¡¶éƒ¨">â†‘</button>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const galleryElement = document.getElementById('gallery');
            const foldersElement = document.getElementById('folders');
            const breadcrumbElement = document.getElementById('breadcrumb');
            const backToTopButton = document.getElementById('backToTop');
            
            // æ”¯æŒçš„å›¾ç‰‡æ ¼å¼
            const imgExtensions = ['.jpg', '.jpeg', '.png', '.gif', '.webp', '.bmp', '.svg'];
            
            // å½“å‰è·¯å¾„
            let currentPath = '';
            
            // å­˜å‚¨æ‰€æœ‰å‘ç°çš„å›¾ç‰‡
            let allImages = [];
            
            // åˆå§‹åŒ–
            loadDirectory(currentPath);
            
            // å¤„ç†é¢åŒ…å±‘å¯¼èˆªç‚¹å‡»
            breadcrumbElement.addEventListener('click', function(e) {
                e.preventDefault();
                if (e.target.tagName === 'A') {
                    currentPath = e.target.getAttribute('data-path');
                    loadDirectory(currentPath);
                }
            });
            
            // å¤„ç†è¿”å›é¡¶éƒ¨æŒ‰é’®
            window.addEventListener('scroll', function() {
                if (window.pageYOffset > 300) {
                    backToTopButton.style.display = 'block';
                } else {
                    backToTopButton.style.display = 'none';
                }
            });
            
            backToTopButton.addEventListener('click', function() {
                window.scrollTo({ top: 0, behavior: 'smooth' });
            });
            
            // åŠ è½½æŒ‡å®šç›®å½•
            function loadDirectory(path) {
                galleryElement.innerHTML = '<div class="loading">æ­£åœ¨åŠ è½½å†…å®¹...</div>';
                foldersElement.innerHTML = '';
                
                // æ›´æ–°é¢åŒ…å±‘å¯¼èˆª
                updateBreadcrumb(path);
                
                // æ„å»ºè¯·æ±‚URL
                const requestUrl = path ? path + '/' : '.';
                
                fetch(requestUrl)
                    .then(response => response.text())
                    .then(html => {
                        // æ¸…é™¤åŠ è½½ä¿¡æ¯
                        galleryElement.innerHTML = '';
                        
                        // åˆ›å»ºä¸´æ—¶DOMå…ƒç´ æ¥è§£æå“åº”
                        const parser = new DOMParser();
                        const doc = parser.parseFromString(html, 'text/html');
                        
                        // è·å–æ‰€æœ‰é“¾æ¥
                        const links = doc.querySelectorAll('a');
                        
                        // å­˜å‚¨å½“å‰ç›®å½•çš„æ–‡ä»¶å¤¹å’Œå›¾ç‰‡
                        const folders = [];
                        const images = [];
                        
                        // å¤„ç†é“¾æ¥
                        links.forEach(link => {
                            const href = link.getAttribute('href');
                            // è·³è¿‡çˆ¶ç›®å½•é“¾æ¥
                            if (href === '../' || href === './' || !href) return;
                            
                            // æ„å»ºå®Œæ•´è·¯å¾„
                            const fullPath = path ? path + '/' + href : href;
                            
                            // æ£€æŸ¥æ˜¯å¦æ˜¯æ–‡ä»¶å¤¹ï¼ˆä»¥/ç»“å°¾ï¼‰
                            if (href.endsWith('/')) {
                                // ç§»é™¤å°¾éƒ¨æ–œæ ä»¥è·å¾—æ–‡ä»¶å¤¹å
                                const folderName = href.slice(0, -1);
                                folders.push({
                                    name: folderName,
                                    path: fullPath.slice(0, -1)
                                });
                            } 
                            // æ£€æŸ¥æ˜¯å¦æ˜¯å›¾ç‰‡
                            else if (imgExtensions.some(ext => href.toLowerCase().endsWith(ext))) {
                                images.push({
                                    name: href,
                                    path: fullPath,
                                    directory: path
                                });
                            }
                        });
                        
                        // æ˜¾ç¤ºæ–‡ä»¶å¤¹
                        if (folders.length > 0) {
                            folders.forEach(folder => {
                                const folderElement = createFolderElement(folder);
                                foldersElement.appendChild(folderElement);
                            });
                        }
                        
                        // æ˜¾ç¤ºå›¾ç‰‡
                        if (images.length > 0) {
                            images.forEach(image => {
                                const imageElement = createImageElement(image);
                                galleryElement.appendChild(imageElement);
                            });
                        } else if (folders.length === 0) {
                            galleryElement.innerHTML = '<div class="loading">å½“å‰ç›®å½•æ²¡æœ‰å›¾ç‰‡</div>';
                        }
                        
                        // å¦‚æœæ²¡æœ‰å†…å®¹
                        if (folders.length === 0 && images.length === 0) {
                            galleryElement.innerHTML = '<div class="loading">å½“å‰ç›®å½•ä¸ºç©º</div>';
                        }
                    })
                    .catch(error => {
                        console.error('åŠ è½½ç›®å½•å†…å®¹æ—¶å‡ºé”™:', error);
                        galleryElement.innerHTML = '<div class="loading">åŠ è½½ç›®å½•å†…å®¹æ—¶å‡ºé”™</div>';
                    });
            }
            
            // åˆ›å»ºæ–‡ä»¶å¤¹å…ƒç´ 
            function createFolderElement(folder) {
                const item = document.createElement('div');
                item.className = 'folder-item';
                item.setAttribute('data-path', folder.path);
                
                const icon = document.createElement('div');
                icon.className = 'folder-icon';
                icon.textContent = 'ğŸ“';
                
                const name = document.createElement('div');
                name.className = 'folder-name';
                name.textContent = folder.name;
                
                item.appendChild(icon);
                item.appendChild(name);
                
                // ç‚¹å‡»æ–‡ä»¶å¤¹æ—¶å¯¼èˆªåˆ°è¯¥æ–‡ä»¶å¤¹
                item.addEventListener('click', function() {
                    currentPath = folder.path;
                    loadDirectory(currentPath);
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                });
                
                return item;
            }
            
            // åˆ›å»ºå›¾ç‰‡å…ƒç´ 
            function createImageElement(image) {
                const item = document.createElement('div');
                item.className = 'gallery-item';
                
                const img = document.createElement('img');
                img.src = image.path;
                img.alt = image.name;
                img.loading = 'lazy'; // å»¶è¿ŸåŠ è½½
                
                const info = document.createElement('div');
                info.className = 'image-info';
                
                const name = document.createElement('h3');
                name.className = 'image-name';
                name.textContent = image.name;
                
                const pathInfo = document.createElement('p');
                pathInfo.className = 'path-info';
                pathInfo.textContent = image.directory || 'æ ¹ç›®å½•';
                
                info.appendChild(name);
                info.appendChild(pathInfo);
                item.appendChild(img);
                item.appendChild(info);
                
                // ç‚¹å‡»å›¾ç‰‡æ—¶å…¨å±æ˜¾ç¤º
                item.addEventListener('click', function() {
                    window.open(image.path, '_blank');
                });
                
                return item;
            }
            
            // æ›´æ–°é¢åŒ…å±‘å¯¼èˆª
            function updateBreadcrumb(path) {
                // æ¸…é™¤ç°æœ‰å¯¼èˆªï¼ˆä¿ç•™é¦–é¡µï¼‰
                while (breadcrumbElement.childNodes.length > 1) {
                    breadcrumbElement.removeChild(breadcrumbElement.lastChild);
                }
                
                // å¦‚æœä¸æ˜¯æ ¹ç›®å½•ï¼Œåˆ›å»ºè·¯å¾„å¯¼èˆª
                if (path) {
                    const parts = path.split('/');
                    let currentPath = '';
                    
                    parts.forEach((part, index) => {
                        // æ·»åŠ åˆ†éš”ç¬¦
                        breadcrumbElement.appendChild(document.createTextNode(' > '));
                        
                        // æ„å»ºå½“å‰éƒ¨åˆ†çš„å®Œæ•´è·¯å¾„
                        currentPath += (index > 0 ? '/' : '') + part;
                        
                        // åˆ›å»ºé“¾æ¥
                        const link = document.createElement('a');
                        link.href = '#';
                        link.setAttribute('data-path', currentPath);
                        link.textContent = part;
                        breadcrumbElement.appendChild(link);
                    });
                }
            }
        });
    </script>
</body>
</html>
